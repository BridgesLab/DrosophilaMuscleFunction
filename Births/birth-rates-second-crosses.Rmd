# Analysis of Birth Ratios for Muscle Tsc1/Raptor Flies -- Second Crosses

## Experimental Design

This was for the second batch of knockdown crosses in which only homozygous drivers were used.

```{r data-input, echo=FALSE}
births_worksheet_location <- 'https://docs.google.com/spreadsheet/pub?key=0Aitfmor6rCjYdHpHTk1BZVh0MFEtNDV6QVI2V2RWSEE&single=true&gid=0&output=csv' 
pupae_worksheet_location <- 'https://docs.google.com/spreadsheet/pub?key=0Aitfmor6rCjYdDVMbEVRd2NLbEpTQUM3REpKSEY3ckE&single=true&gid=0&output=csv'
mapping_file <- '../Data/gene_mapping.csv'
mapping.data <- read.csv(mapping_file)

birth_file_name <- '../Data/Birth Data.csv'
download.file(births_worksheet_location, birth_file_name, method="curl")
birth_data <- read.csv(birth_file_name)

pupae_filename <- '../Data/Pupae Inspection Data.csv'
download.file(pupae_worksheet_location, pupae_filename, method="curl")
pupae_data <- read.csv(pupae_filename)
```

These data are the raw data saved in `r birth_file_name` for the births and `r pupae_filename` for the pupae inspection.  This script was most recently run on `r date()`.

## C179-GAL4 Driver

This analysis is just for the C179 Driver.

```{r data-collection-c179, echo=FALSE}
library(reshape2)
combined_pupae_data <- merge(pupae_data, dcast(droplevels(subset(birth_data, Female != 'Mef-Gal4')), Female+Male+CrossName~Gender, value.var='Count', sum), by='CrossName', all=T)
combined_pupae_data$Live.Flies <- combined_pupae_data$Females + combined_pupae_data$Males
combined_pupae_data$Total.Pupae <- combined_pupae_data$Dead.Flies + combined_pupae_data$Empty.Larvae

#sets a sum of zero to be NA if the total number of alive flies was zero
#combined_pupae_data[combined_pupae_data$Live.Flies==0&!(is.na(combined_pupae_data$Live.Flies)),]$Live.Flies <- NA
combined_pupae_data[is.na(combined_pupae_data$Live.Flies),]$Females <- NA
combined_pupae_data[is.na(combined_pupae_data$Live.Flies),]$Males <- NA

combined_pupae_data$Dead.Pupae.pct <- combined_pupae_data$Dead.Flies/combined_pupae_data$Total.Pupae*100
combined_pupae_data$UAS <- as.factor(sapply(strsplit(as.character(combined_pupae_data$Male), '/'),"[", 1))
combined_pupae_data$Driver <- as.factor(sapply(strsplit(as.character(combined_pupae_data$Female), '/'),"[", 1))

annotated_pupae_data <- merge(mapping.data, combined_pupae_data, by='UAS', all.y=T)
annotated_pupae_data <- droplevels(annotated_pupae_data)
output_pupae_file <- '../data/processed/Homozygous Crosses Pupae Data.csv'
write.csv(annotated_pupae_data, output_pupae_file)
annotated_pupae_data$UAS <- as.factor(annotated_pupae_data$UAS)
annotated_pupae_data$UAS <- relevel(annotated_pupae_data$UAS, ref='36304')

#this calculates the summary statistics for total number of flies
library(plyr)
total_fly_summary <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Live.Flies, na.rm=T),
                        se = sd(Live.Flies, na.rm=T)/sqrt(length(Live.Flies)),
                        sd = sd(Live.Flies, na.rm=T),
                        rel.error = sd(Live.Flies, na.rm=T)/mean(Live.Flies, na.rm=T)*100,                          
                        n = length(Live.Flies))

total_fly_summary_raptor <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'&Gene %in% c("Control","Raptor")), ~Gene+UAS, summarize,
                        mean = mean(Live.Flies, na.rm=T),
                        se = sd(Live.Flies, na.rm=T)/sqrt(length(Live.Flies)),
                        sd = sd(Live.Flies, na.rm=T),
                        rel.error = sd(Live.Flies, na.rm=T)/mean(Live.Flies, na.rm=T)*100,                          
                        n = length(Live.Flies))
#calculated just for males
total_fly_summary_males <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Males, na.rm=T),
                        se = sd(Males, na.rm=T)/sqrt(length(Males)),
                        sd = sd(Males, na.rm=T),
                        rel.error = sd(Males, na.rm=T)/mean(Males, na.rm=T)*100,                          
                        n = length(Males))

#calculated just for females
total_fly_summary_females <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Females, na.rm=T),
                        se = sd(Females, na.rm=T)/sqrt(length(Females)),
                        sd = sd(Females, na.rm=T),
                        rel.error = sd(Females, na.rm=T)/mean(Females, na.rm=T)*100,                          
                        n = length(Females))

#this calcualtes the summary statistics for total number of pupae
total_pupae_summary_c179 <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Total.Pupae, na.rm=T),
                        se = sd(Total.Pupae, na.rm=T)/sqrt(length(Total.Pupae)),
                        sd = sd(Total.Pupae, na.rm=T),
                        rel.error = sd(Total.Pupae, na.rm=T)/mean(Total.Pupae, na.rm=T)*100,                              
                        n = length(Total.Pupae))

total_pupae_summary_c179_raptor <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'&Gene%in%c("Control","Raptor")), ~Gene+UAS, summarize,
                        mean = mean(Total.Pupae, na.rm=T),
                        se = sd(Total.Pupae, na.rm=T)/sqrt(length(Total.Pupae)),
                        sd = sd(Total.Pupae, na.rm=T),
                        rel.error = sd(Total.Pupae, na.rm=T)/mean(Total.Pupae, na.rm=T)*100,                              
                        n = length(Total.Pupae))

#this calcualtes the summary statistics for dead pupae 
dead_pupae_summary_c179 <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Dead.Pupae.pct, na.rm=T),
                        se = sd(Dead.Pupae.pct, na.rm=T)/sqrt(length(Dead.Pupae.pct)),
                        sd = sd(Dead.Pupae.pct, na.rm=T),
                        rel.error = sd(Dead.Pupae.pct, na.rm=T)/mean(Dead.Pupae.pct, na.rm=T)*100,
                        n = length(Dead.Pupae.pct))

dead_pupae_summary_c179_raptor <- ddply(subset(annotated_pupae_data, Driver=='C179-Gal4'&Gene%in%c('Control','Raptor')), ~Gene+UAS, summarize,
                        mean = mean(Dead.Pupae.pct, na.rm=T),
                        se = sd(Dead.Pupae.pct, na.rm=T)/sqrt(length(Dead.Pupae.pct)),
                        sd = sd(Dead.Pupae.pct, na.rm=T),
                        rel.error = sd(Dead.Pupae.pct, na.rm=T)/mean(Dead.Pupae.pct, na.rm=T)*100,
                        n = length(Dead.Pupae.pct))
```

```{r c179-total-pupae-statistics, echo=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
total.pupae.c179.aov <- aov(Total.Pupae~Driver*UAS, data=annotated_pupae_data)
total.pupae.c179.raptor.aov <- aov(Total.Pupae~Driver*UAS, data=subset(annotated_pupae_data, Gene%in%c('Control','Raptor')))
library(car)
```

These aggregaged and annotated data are written out to the file `r output_pupae_file`.

### Analysis of Pupae

We inspected the pupae from vials, 21 days after the cross was set up and counted how many pupae were present, and how many had dead flies in them.  These data are summarized below:

```{r pupae-summary-tables-c179,echo=FALSE,results='asis', message=FALSE}
library(xtable)
print(xtable(total_pupae_summary_c179, caption="Summary of the Number of Pupae by Driver and UAS for C179-GAL4", label="tab:total-pupae-summary"), include.rownames=F, type='html')
```

```{r c179-total-pupae-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_pupae_summary_c179$mean+total_pupae_summary_c179$se, na.rm=T)
plot <- barplot(total_pupae_summary_c179$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_pupae_summary_c179$UAS,
        col=total_pupae_summary_c179$Gene,
        ylab="Total Number of Pupae",
        xlab="shRNA Clone",
        main="Total Number of Pupae Using the C179-GAL4 Driver")

legend("top", levels(total_pupae_summary_c179$Gene)[1:2], fill= palette()[1:2], bty='n')

superpose.eb <- 
 function (x, y, ebl, ebu = ebl, length = 0.08, ...) 
 arrows(x, y + ebu, x, y - ebl, angle = 90, code = 3, 
 length = length, ...)

superpose.eb(plot, 
             total_pupae_summary_c179$mean,
             total_pupae_summary_c179$se)
```


To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of dead pupae.  We then checked wither the residuals were normally distributed.  The p-value for that Shapiro-Wilk test was p=`r shapiro.test(residuals(total.pupae.c179.aov))$p.value`.  We also checked for equal variance between groups.  The p-value for t hat Levene's test was `r leveneTest(Total.Pupae~UAS, data=subset(annotated_pupae_data,Driver%in%c('C179-Gal4')))$"Pr(>F)"[1]`.  

Based on this the ANOVA assumptions were met.  Therefore the p-value for effect of genotype on total pupae is **`r summary(total.pupae.c179.aov)[[1]][["Pr(>F)"]][2]`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Total.Pupae~Driver, subset(annotated_pupae_data, UAS==36304))$p.value`**.  These data indicatee that there was no significant effect on the number of pupae.

### Raptor Knockdown Only
Looking only at *Raptor* knockdown flies separate from *Tsc1* knockdown flies we see the following.

```{r pupae-summary-tables-c179-raptor,echo=FALSE,results='asis', message=FALSE}
print(xtable(total_pupae_summary_c179_raptor, caption="Summary of the Number of Pupae by Driver and UAS for C179-GAL4", label="tab:total-pupae-summary"), include.rownames=F, type='html')
```

```{r c179-raptor-total-pupae-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_pupae_summary_c179_raptor$mean+total_pupae_summary_c179_raptor$se, na.rm=T)
plot <- barplot(total_pupae_summary_c179_raptor$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_pupae_summary_c179_raptor$UAS,
        col=total_pupae_summary_c179_raptor$Gene,
        ylab="Total Number of Pupae",
        xlab="shRNA Clone",
        main="Total Number of Pupae Using the C179-GAL4 Driver")

legend("topright", levels(total_pupae_summary_c179_raptor$Gene)[1:2], fill= palette()[1:2], bty='n')

superpose.eb(plot, 
             total_pupae_summary_c179_raptor$mean,
             total_pupae_summary_c179_raptor$se)
```


To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of dead pupae.  We then checked wither the residuals were normally distributed.  The p-value for that Shapiro-Wilk test was p=`r shapiro.test(residuals(total.pupae.c179.raptor.aov))$p.value`.  We also checked for equal variance between groups.  The p-value for t hat Levene's test was `r leveneTest(Total.Pupae~Driver*UAS, data=subset(annotated_pupae_data,Driver=='C179-Gal4'&Gene%in%c('Control','Raptor')))$"Pr(>F)"[1]`.  

Based on this the ANOVA assumptions were met.  Therefore the p-value for effect of genotype on total pupae is **`r summary(total.pupae.c179.raptor.aov)[[1]][["Pr(>F)"]][2]`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Total.Pupae~Driver, subset(annotated_pupae_data, UAS==36304&Gene%in%c('Control','Raptor')))$p.value`**.  These data indicatee that there was no significant effect on the number of pupae.


### Analysis of Dead Pupae

We next analysed how many pupae were dead, as a percentage of the total number of pupae.

```{r c179-dead-pupae-statistics, echo=FALSE, message=FALSE, warning=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
dead.pupae.aov <- aov(Dead.Pupae.pct~Driver*UAS, data=annotated_pupae_data)
dead.pupae.c179.aov <- aov(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'))
dead.pupae.c179.kw <- kruskal.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'))
#did dunnet test vs the control
library(multcomp)
pupae.dunnett <- glht(dead.pupae.c179.aov, linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
pupae.dunnett.summary <- cbind(summary(pupae.dunnett)$test$coefficients, summary(pupae.dunnett)$test$pvalues)
colnames(pupae.dunnett.summary) <- c("Effect Size (%)", "p-value")

dead.pupae.wilcoxon <- data.frame(row.names=levels(annotated_pupae_data$UAS))

for (uas in levels(annotated_pupae_data$UAS)) {
  if (uas %in% c('36304','35144')){
      dead.pupae.wilcoxon[uas,'pval'] <- NA
}
else
    dead.pupae.wilcoxon[uas,'pval'] <- wilcox.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'&UAS%in%c('36304',uas)))$p.value
}
dead.pupae.wilcoxon$padj <- p.adjust(dead.pupae.wilcoxon$pval, method="BH")
```

A summary of the percent of dead pupae for each cross is shown below:

```{r c179-pupae-summary-tables,echo=FALSE,results='asis'}
print(xtable(dead_pupae_summary_c179, caption="Summary of Percent of Dead Pupae by Driver and UAS for C179-GAL4", label="tab:dead-pupae-summary"), include.rownames=F, type='html')
```


```{r c179-dead-pupae-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(dead_pupae_summary_c179$mean+dead_pupae_summary_c179$se, na.rm=T)
plot <- barplot(dead_pupae_summary_c179$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=dead_pupae_summary_c179$UAS,
        col=dead_pupae_summary_c179$Gene,
        ylab="Percent of Dead Pupae",
        xlab="shRNA Clone",
        main="Percent of Dead Pupae Using the C179-GAL4 Driver")

legend("topleft", levels(dead_pupae_summary_c179$Gene), fill= palette()[1:length(levels(dead_pupae_summary_c179$Gene))], bty='n')

superpose.eb(plot, 
             dead_pupae_summary_c179$mean,
             dead_pupae_summary_c179$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of dead pupae.  We then checked wither the residuals were normally distributed.  The p-value for that Shapiro-Wilk test was p=`r shapiro.test(residuals(dead.pupae.c179.aov))$p.value`.  We also checked for equal variance between groups.  The p-value for that Levene's test was `r leveneTest(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data,Driver=="C179-Gal4"))$"Pr(>F)"[1]`, so neither the assumptions of equal variance or normality were met for these data.

Therefore rather than an ANOVA, we did a Kruskal-Wallis test.  The p-value for that comparason is **`r dead.pupae.c179.kw$p.value`** for the UAS.  To test if the driver alone had an effect with did a Wilcoxon Rank Sum Test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r wilcox.test(Dead.Pupae.pct~Driver, subset(annotated_pupae_data, UAS=36304))$p.value`**.  We therefore excluded the +/+ progeny from the analysis and compared with the *C179-Gal4/+* progeny as a control.  

Since this ANOVA was significant, we did post-hoc Wilcoxon-Rank Sum Tests to look at each strain relative to the control.  To test for differences compared to the *C179-GAL4/+* control strain, the results of this test are shown below.

```{r c179-pupae-dunnett-tables,echo=FALSE,results='asis'}
print(xtable(dead.pupae.wilcoxon, caption="Wilcoxon Rank Sum Tests for the Percent of Dead Pupae Comparing to Control (C179-Gal4/+)", label="tab:dead-pupae-wilcoxon", digits=c(0,5,5)), type='html')
```

#### Raptor Knockdown Only

```{r c179-raptor-dead-pupae-statistics, echo=FALSE, message=FALSE, warning=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
dead.pupae.raptor.aov <- aov(Dead.Pupae.pct~Driver*UAS, data=subset(annotated_pupae_data, Gene %in% c('Control','Raptor')))
dead.pupae.c179.raptor.aov <- aov(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'&Gene %in% c('Control','Raptor')))
dead.pupae.c179.raptor.kw <- kruskal.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'&Gene %in% c('Control','Raptor')))
#did dunnet test vs the control
library(multcomp)
pupae.dunnett.raptor <- glht(dead.pupae.c179.raptor.aov, linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
pupae.dunnett.raptor.summary <- cbind(summary(pupae.dunnett.raptor)$test$coefficients, summary(pupae.dunnett.raptor)$test$pvalues)
colnames(pupae.dunnett.raptor.summary) <- c("Effect Size (%)", "p-value")

dead.pupae.raptor.wilcoxon <- data.frame(row.names=levels(droplevels(subset(annotated_pupae_data, Driver=='C179-Gal4'&Gene %in% c('Control','Raptor')))$UAS))

for (uas in rownames(dead.pupae.raptor.wilcoxon)) {
  if (uas %in% c('36304')){
      dead.pupae.raptor.wilcoxon[uas,'pval'] <- NA
}
else
    dead.pupae.raptor.wilcoxon[uas,'pval'] <- wilcox.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'&UAS%in%c('36304',uas)))$p.value
}
dead.pupae.raptor.wilcoxon$padj <- p.adjust(dead.pupae.raptor.wilcoxon$pval, method="BH")
```

A summary of the percent of dead pupae for each cross is shown below:

```{r c179-raptor-pupae-summary-tables,echo=FALSE,results='asis'}
print(xtable(dead_pupae_summary_c179_raptor, caption="Summary of Percent of Dead Pupae by Driver and UAS for C179-GAL4", label="tab:dead-pupae-summary"), include.rownames=F, type='html')
```


```{r c179-raptor-dead-pupae-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(dead_pupae_summary_c179_raptor$mean+dead_pupae_summary_c179_raptor$se, na.rm=T)
plot <- barplot(dead_pupae_summary_c179_raptor$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=dead_pupae_summary_c179_raptor$UAS,
        col=dead_pupae_summary_c179_raptor$Gene,
        ylab="Percent of Dead Pupae",
        xlab="shRNA Clone",
        main="Percent of Dead Pupae Using the C179-GAL4 Driver")

legend("topleft", levels(dead_pupae_summary_c179_raptor$Gene)[1:2], fill= palette()[1:2], bty='n')

superpose.eb(plot, 
             dead_pupae_summary_c179_raptor$mean,
             dead_pupae_summary_c179_raptor$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of dead pupae.  We then checked wither the residuals were normally distributed.  The p-value for that Shapiro-Wilk test was p=`r shapiro.test(residuals(dead.pupae.c179.raptor.aov))$p.value`.  We also checked for equal variance between groups.  The p-value for that Levene's test was `r leveneTest(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data,Driver=="C179-Gal4"&Gene%in%c('Control','Raptor')))$"Pr(>F)"[1]`, so neither the assumptions of equal variance or normality were met for these data.

Therefore rather than an ANOVA, we did a Kruskal-Wallis test.  The p-value for that comparason is **`r dead.pupae.c179.kw$p.value`** for the UAS.  To test if the driver alone had an effect with did a Wilcoxon Rank Sum Test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r wilcox.test(Dead.Pupae.pct~Driver, subset(annotated_pupae_data, UAS=36304))$p.value`**.  We therefore excluded the +/+ progeny from the analysis and compared with the *C179-Gal4/+* progeny as a control.  

Since this ANOVA was significant, we did post-hoc Wilcoxon-Rank Sum Tests to look at each strain relative to the *C179-GAL4/+* control strain.  The range was `r (min(dead_pupae_summary_c179_raptor$mean[2:4])-dead_pupae_summary_c179_raptor$mean[1])/dead_pupae_summary_c179_raptor$mean[1]`-`r (max(dead_pupae_summary_c179_raptor$mean[2:4])-dead_pupae_summary_c179_raptor$mean[1])/dead_pupae_summary_c179_raptor$mean[1]` times more dead pupae.  The results of these tests are shown below.

```{r c179-raptor-pupae-dunnett-tables,echo=FALSE,results='asis'}
print(xtable(dead.pupae.raptor.wilcoxon, caption="Wilcoxon Rank Sum Tests for the Percent of Dead Pupae Comparing to Control (C179-Gal4/+)", label="tab:dead-pupae-wilcoxon", digits=c(0,5,5)), type='html')
```
     
### Analysis of Total Number of Flies

```{r c179-total-fly-statistics, echo=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
total.flies.aov <- aov(Live.Flies~Driver*UAS, data=annotated_pupae_data)
total.flies.raptor.aov <- aov(Live.Flies~Driver*UAS, data=subset(annotated_pupae_data, Gene %in% c("Control","Raptor")))
restricted.flies.aov <- aov(Live.Flies~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'))
restricted.flies.raptor.aov <- aov(Live.Flies~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'&Gene %in% c("Control","Raptor")))
total.flies.dunnett <- glht(restricted.flies.aov , linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
fly.dunnett.summary <- cbind(summary(total.flies.dunnett)$test$coefficients, summary(total.flies.dunnett)$test$pvalues)
colnames(fly.dunnett.summary) <- c("Effect Size (%)", "p-value")

#for raptor only
total.flies.raptor.dunnett <- glht(restricted.flies.raptor.aov , linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
fly.dunnett.summary.raptor <- cbind(summary(total.flies.raptor.dunnett)$test$coefficients, summary(total.flies.raptor.dunnett)$test$pvalues)
colnames(fly.dunnett.summary.raptor) <- c("Effect Size (%)", "p-value")
```


We inspected the total number of flies eclosed up to 21 days after the cross was set up.  These data are summarized in the table and figure below:

```{r c179-total-fly-summary-tables,echo=FALSE,results='asis'}
print(xtable(total_fly_summary, caption="Summary of the Number of Flies by Driver and UAS for C179-GAL4", label="tab:total-flies-summary"), include.rownames=F, type='html')
```

```{r c179-total-fly-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_fly_summary$mean+total_fly_summary$se, na.rm=T)
plot <- barplot(total_fly_summary$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary$UAS,
        col=total_fly_summary$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Flies for the C179-GAL4 Driver")

legend("top", levels(total_fly_summary$Gene), fill= palette()[1:length(levels(total_fly_summary$Gene))], bty='n')

superpose.eb(plot, 
             total_fly_summary$mean,
             total_fly_summary$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  We checked the residuals for this ANOVA by Shapiro-Wilk test (p=`r shapiro.test(residuals(total.flies.aov))$p.value`), so the data can be assumed to be normally distributed.  A Levene's test had a p-value of `r leveneTest(Live.Flies~Driver*UAS, data=annotated_pupae_data)$"Pr(>F)"[1]`, therefore both ANOVA assumptions can be accepted.  

The p-value for the ANOVA is **`r summary(total.flies.aov)[[1]][["Pr(>F)"]][2]`** for the UAS.  The results of this ANOVA are shown in Table \ref{tab:total-flies-anova}.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Live.Flies~Driver, subset(annotated_pupae_data, UAS=36304))$p.value`**.  

Due to the significant ANOVA we performed a post-hoc Dunnett's test using the *C179/+* progeny as the controls.  An ANOVA analysis excluding the +/+ flies had a p-value of **`r summary(restricted.flies.aov)[[1]][["Pr(>F)"]][1]`** for the UAS.  The results of that test are in the Table below.  This test indicates that each of the three Raptor shRNA knockdowns cause a reduction in the number of flies.

```{r c179-total-fly-dunnett-gender-tables,echo=FALSE,results='asis'}
print(xtable(fly.dunnett.summary, caption="Dunnett's Test for the Number of Males and Females Comparing to Control (C179-Gal4/+)", label="tab:total-flies-dunnett-gendered", digits=c(0,1,7)), type='html')
```

### Only Raptor Knockdown Flies

```{r c179-raptor-total-fly-summary-tables,echo=FALSE,results='asis'}
print(xtable(total_fly_summary_raptor, caption="Summary of the Number of Flies by Driver and UAS for C179-GAL4", label="tab:total-flies-summary"), include.rownames=F, type='html')
```

```{r c179-raptor-total-fly-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_fly_summary_raptor$mean+total_fly_summary_raptor$se, na.rm=T)
plot <- barplot(total_fly_summary_raptor$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary_raptor$UAS,
        col=total_fly_summary_raptor$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Flies for the C179-GAL4 Driver")

legend("top", levels(total_fly_summary_raptor$Gene)[1:2], fill= palette()[1:2], bty='n')

superpose.eb(plot, 
             total_fly_summary_raptor$mean,
             total_fly_summary_raptor$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  We checked the residuals for this ANOVA by Shapiro-Wilk test (p=`r shapiro.test(residuals(total.flies.raptor.aov))$p.value`), so the data can be assumed to be normally distributed.  A Levene's test had a p-value of `r leveneTest(Live.Flies~Driver*UAS, data=subset(annotated_pupae_data, Gene %in% c("Control", "Raptor")))$"Pr(>F)"[1]`, therefore both ANOVA assumptions can be accepted.  

The p-value for the ANOVA is **`r summary(total.flies.aov)[[1]][["Pr(>F)"]][2]`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Live.Flies~Driver, subset(annotated_pupae_data, UAS=36304), var.equal=F)$p.value`**.  

Due to the significant ANOVA we performed a post-hoc Dunnett's test using the *C179/+* progeny as the controls.  An ANOVA analysis excluding the +/+ flies had a p-value of **`r summary(restricted.flies.aov)[[1]][["Pr(>F)"]][1]`** for the UAS.  The results of that test are in the Table below.  This test indicates that each of the three Raptor shRNA knockdowns cause a reduction in the number of flies.  There was between a `r (total_fly_summary_raptor$mean[1]-max(total_fly_summary_raptor$mean[2:4]))/total_fly_summary_raptor$mean[1]*100` and `r (total_fly_summary_raptor$mean[1]-min(total_fly_summary_raptor$mean[2:4]))/total_fly_summary_raptor$mean[1]*100`% decrease in the number of eclosed flies depending on the strain.

```{r c179-raptor-total-fly-dunnett-gender-tables,echo=FALSE,results='asis'}
print(xtable(fly.dunnett.summary.raptor, caption="Dunnett's Test for the Number of Males and Females Comparing to Control (C179-Gal4/+)", label="tab:total-flies-dunnett-raptor", digits=c(0,1,7)), type='html')
```

### Analysis of Number of Flies by Gender

```{r c179-total-fly-statistics-gender, echo=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
total.flies.aov.males <- aov(Males~Driver*UAS, data=annotated_pupae_data)
total.flies.aov.females <- aov(Females~Driver*UAS, data=annotated_pupae_data)

restricted.flies.aov.males <- aov(Males~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'))
restricted.flies.aov.females <- aov(Females~UAS, data=subset(annotated_pupae_data, Driver=='C179-Gal4'))

total.flies.dunnett.males <- glht(restricted.flies.aov.males , linfct=mcp(UAS="Dunnett"))
total.flies.dunnett.females <- glht(restricted.flies.aov.females , linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
fly.dunnett.summary.gendered <- cbind(summary(total.flies.dunnett.males)$test$coefficients, 
                             summary(total.flies.dunnett.males)$test$pvalues,
                             summary(total.flies.dunnett.females)$test$coefficients, 
                             summary(total.flies.dunnett.females)$test$pvalues)
colnames(fly.dunnett.summary.gendered) <- c("Male Effect Size (%)", "Male p-value","Female Effect Size (%)", "Female p-value")
```

For the flies which had been born, we could separate these data based on gender.  The separated data is summarized in Tables \ref{tab:total-flies-summary-males} and \ref{tab:total-flies-summary-females}.  These data are graphed in Figure \ref{fig:total-flies-barplot-gendered}.  

For Males, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  The p-value for that comparason is **`r summary(total.flies.aov.males)[[1]][["Pr(>F)"]][2]`** for the UAS.  The results of this ANOVA are shown in Table \ref{tab:total-flies-anova-males}.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Males~Driver, subset(annotated_pupae_data, UAS=36304))$p.value`**. 

For Females, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  The p-value for that comparason is **`r summary(total.flies.aov.females)[[1]][["Pr(>F)"]][2]`** for the UAS.  The results of this ANOVA are shown in Table \ref{tab:total-flies-anova-females}.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Females~Driver, subset(annotated_pupae_data, UAS=36304))$p.value`**. 

Due to the significant ANOVA we performed a post-hoc Dunnett's test using the *C179/+* progeny as the controls.  An ANOVA analysis excluding the +/+ flies had a p-value of **`r summary(restricted.flies.aov.males)[[1]][["Pr(>F)"]][1]`** for the UAS for males and a p-value of **`r summary(restricted.flies.aov.females)[[1]][["Pr(>F)"]][1]`** for the UAS for the females.  The results of that test are in the table below.  This test indicates that each of the three Raptor shRNA knockdowns cause a reduction in the number of male flies, but only 34814 had significantly less females.

```{r c179-total-fly-summary-gender-tables,echo=FALSE,results='asis'}
print(xtable(total_fly_summary_males, caption="Summary of the Number of Male Flies by Driver and UAS for C179-GAL4", label="tab:total-flies-summary-males"), include.rownames=F, type='html')
print(xtable(total_fly_summary_females, caption="Summary of the Number of Female Flies by Driver and UAS for C179-GAL4", label="tab:total-flies-summary-females"), include.rownames=F, type='html')
print(xtable(total.flies.aov.males, caption="ANOVA for the Number of Male Flies by Driver and UAS for C179-GAL4", label="tab:total-flies-anova-males"), type='html')
print(xtable(total.flies.aov.females, caption="ANOVA for the Number of Female Flies by Driver and UAS for C179-GAL4", label="tab:total-flies-anova-females"), type='html')
print(xtable(fly.dunnett.summary.gendered, caption="Dunnett's Test for the Number of Males and Females Comparing to Control (C179-Gal4/+)", label="tab:total-flies-dunnett-gendered", digits=c(0,1,7,1,7)), type='html')
```

```{r total-fly-barplot-gendered,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
par(mfrow=c(2,1))
ymax <- max(total_fly_summary_males$mean+total_fly_summary_males$se, na.rm=T)
plot <- barplot(total_fly_summary_males$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary_males$UAS,
        col=total_fly_summary_males$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Male Flies")

legend("top", levels(total_fly_summary_males$Gene), fill= palette()[1:length(levels(total_fly_summary_males$Gene))], bty='n')

superpose.eb(plot, 
             total_fly_summary_males$mean,
             total_fly_summary_males$se)

ymax <- max(total_fly_summary_females$mean+total_fly_summary_females$se, na.rm=T)
plot <- barplot(total_fly_summary_females$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary_females$UAS,
        col=total_fly_summary_females$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Female Flies")

superpose.eb(plot, 
             total_fly_summary_females$mean,
             total_fly_summary_females$se)
```
     
## Mef-GAL4 Driver

This analysis is just for the *Mef2-GAL4* Driver.

```{r data-collection-mef, echo=FALSE}
combined_pupae_data_mef <- merge(pupae_data, dcast(droplevels(subset(birth_data, Female != 'C179-Gal4')), Female+Male+CrossName~Gender, value.var='Count', sum), by='CrossName', all=T)
combined_pupae_data_mef$Live.Flies <- combined_pupae_data_mef$Females + combined_pupae_data_mef$Males
combined_pupae_data_mef$Total.Pupae <- combined_pupae_data_mef$Dead.Flies + combined_pupae_data_mef$Empty.Larvae

#sets a sum of zero to be NA if the total number of alive flies was zero
#combined_pupae_data_mef[combined_pupae_data_mef$Live.Flies==0&!(is.na(combined_pupae_data_mef$Live.Flies)),]$Live.Flies <- NA
combined_pupae_data_mef[is.na(combined_pupae_data_mef$Live.Flies),]$Females <- NA
combined_pupae_data_mef[is.na(combined_pupae_data_mef$Live.Flies),]$Males <- NA

combined_pupae_data_mef$Dead.Pupae.pct <- combined_pupae_data_mef$Dead.Flies/combined_pupae_data_mef$Total.Pupae*100
combined_pupae_data_mef$UAS <- as.factor(sapply(strsplit(as.character(combined_pupae_data_mef$Male), '/'),"[", 1))
combined_pupae_data_mef$Driver <- as.factor(sapply(strsplit(as.character(combined_pupae_data_mef$Female), '/'),"[", 1))

annotated_pupae_data_mef <- merge(mapping.data, combined_pupae_data_mef, by='UAS', all.y=T)
annotated_pupae_data_mef <- droplevels(annotated_pupae_data_mef)
annotated_pupae_data_mef$UAS <- as.factor(annotated_pupae_data_mef$UAS)
annotated_pupae_data_mef$UAS <- relevel(annotated_pupae_data_mef$UAS, ref='36304')

#this calculates the summary statistics for total number of flies
library(plyr)
total_fly_summary_mef <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Live.Flies, na.rm=T),
                        se = sd(Live.Flies, na.rm=T)/sqrt(length(Live.Flies)),
                        sd = sd(Live.Flies, na.rm=T),
                        rel.error = sd(Live.Flies, na.rm=T)/mean(Live.Flies, na.rm=T)*100,                          
                        n = length(Live.Flies))

total_fly_summary_mef_raptor <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4' & Gene %in% c("Control","Raptor")), ~Gene+UAS, summarize,
                        mean = mean(Live.Flies, na.rm=T),
                        se = sd(Live.Flies, na.rm=T)/sqrt(length(Live.Flies)),
                        sd = sd(Live.Flies, na.rm=T),
                        rel.error = sd(Live.Flies, na.rm=T)/mean(Live.Flies, na.rm=T)*100,                          
                        n = length(Live.Flies))
#calculated just for males
total_fly_summary_males_mef <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Males, na.rm=T),
                        se = sd(Males, na.rm=T)/sqrt(length(Males)),
                        sd = sd(Males, na.rm=T),
                        rel.error = sd(Males, na.rm=T)/mean(Males, na.rm=T)*100,                          
                        n = length(Males))

#calculated just for females
total_fly_summary_females_mef <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Females, na.rm=T),
                        se = sd(Females, na.rm=T)/sqrt(length(Females)),
                        sd = sd(Females, na.rm=T),
                        rel.error = sd(Females, na.rm=T)/mean(Females, na.rm=T)*100,                          
                        n = length(Females))

#this calcualtes the summary statistics for total number of pupae
total_pupae_summary_mef <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Total.Pupae, na.rm=T),
                        se = sd(Total.Pupae, na.rm=T)/sqrt(length(Total.Pupae)),
                        sd = sd(Total.Pupae, na.rm=T),
                        rel.error = sd(Total.Pupae, na.rm=T)/mean(Total.Pupae, na.rm=T)*100,                              
                        n = length(Total.Pupae))

total_pupae_summary_mef_raptor <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'&Gene%in%c('Control','Raptor')), ~Gene+UAS, summarize,
                        mean = mean(Total.Pupae, na.rm=T),
                        se = sd(Total.Pupae, na.rm=T)/sqrt(length(Total.Pupae)),
                        sd = sd(Total.Pupae, na.rm=T),
                        rel.error = sd(Total.Pupae, na.rm=T)/mean(Total.Pupae, na.rm=T)*100,                              
                        n = length(Total.Pupae))

#this calcualtes the summary statistics for dead pupae 
dead_pupae_summary_mef <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'), ~Gene+UAS, summarize,
                        mean = mean(Dead.Pupae.pct, na.rm=T),
                        se = sd(Dead.Pupae.pct, na.rm=T)/sqrt(length(Dead.Pupae.pct)),
                        sd = sd(Dead.Pupae.pct, na.rm=T),
                        rel.error = sd(Dead.Pupae.pct, na.rm=T)/mean(Dead.Pupae.pct, na.rm=T)*100)

dead_pupae_summary_mef_raptor <- ddply(subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'&Gene%in%c("Control","Raptor")), ~Gene+UAS, summarize,
                        mean = mean(Dead.Pupae.pct, na.rm=T),
                        se = sd(Dead.Pupae.pct, na.rm=T)/sqrt(length(Dead.Pupae.pct)),
                        sd = sd(Dead.Pupae.pct, na.rm=T),
                        rel.error = sd(Dead.Pupae.pct, na.rm=T)/mean(Dead.Pupae.pct, na.rm=T)*100)
```

```{r mef-total-pupae-statistics, echo=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
total.pupae.mef.aov <- aov(Total.Pupae~Driver*UAS, data=annotated_pupae_data_mef)
total.pupae.mef.raptor.aov <- aov(Total.Pupae~Driver*UAS, data=subset(annotated_pupae_data_mef, Gene%in%c('Control','Raptor')))
```

## Analysis of Pupae

We inspected the pupae from vials, 21 days after the cross was set up and counted how many pupae were present, and how many had dead flies in them.  These data are summarized below:

```{r mef-pupae-summary-tables,echo=FALSE,results='asis'}
print(xtable(total_pupae_summary_mef, caption="Summary of the Number of Pupae by Driver and UAS for Mef-GAL4", label="tab:total-pupae-summary-mef"), include.rownames=F, type='html')
```


```{r mef-total-pupae-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_pupae_summary_mef$mean+total_pupae_summary_mef$se, na.rm=T)
plot <- barplot(total_pupae_summary_mef$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_pupae_summary_mef$UAS,
        col=total_pupae_summary_mef$Gene,
        ylab="Total Number of Pupae",
        xlab="shRNA Clone",
        main="Total Number of Pupae Using the Mef-GAL4 Driver")

legend("top", levels(total_pupae_summary_mef$Gene), fill= palette()[1:length(levels(total_pupae_summary_mef$Gene))], bty='n')

superpose.eb(plot, 
             total_pupae_summary_mef$mean,
             total_pupae_summary_mef$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of dead pupae.  We then checked wither the residuals were normally distributed.  The p-value for that Shapiro-Wilk test was p=`r shapiro.test(residuals(total.pupae.mef.aov))$p.value`.  We also checked for equal variance between groups.  The p-value for that Levene's test was `r leveneTest(Total.Pupae~Driver*UAS, data=annotated_pupae_data_mef)$"Pr(>F)"[1]`.  

Based on this the ANOVA assumptions were met.  Therefore the p-value for that comparason is **`r summary(total.pupae.mef.aov)[[1]][["Pr(>F)"]][2]`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *Mef/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Total.Pupae~Driver, subset(annotated_pupae_data_mef, UAS==36304))$p.value`**.  This indicated that there was no significant effect on the number of pupae.

### Raptor Knockdown Only
Looking only at *Raptor* knockdown flies separate from *Tsc1* knockdown flies we see the following.

```{r pupae-summary-tables-mef-raptor,echo=FALSE,results='asis', message=FALSE}
print(xtable(total_pupae_summary_mef_raptor, caption="Summary of the Number of Pupae by Driver and UAS for C179-GAL4", label="tab:total-pupae-summary"), include.rownames=F, type='html')
```

```{r mef-raptor-total-pupae-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_pupae_summary_mef_raptor$mean+total_pupae_summary_mef_raptor$se, na.rm=T)
plot <- barplot(total_pupae_summary_mef_raptor$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_pupae_summary_mef_raptor$UAS,
        col=total_pupae_summary_c179_raptor$Gene,
        ylab="Total Number of Pupae",
        xlab="shRNA Clone",
        main="Total Number of Pupae Using the Mef-GAL4 Driver")

legend("topleft", levels(total_pupae_summary_mef_raptor$Gene)[1:2], fill= palette()[1:2], bty='n')

superpose.eb(plot, 
             total_pupae_summary_mef_raptor$mean,
             total_pupae_summary_mef_raptor$se)
```


To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of total pupae.  We then checked wither the residuals were normally distributed.  The p-value for that Shapiro-Wilk test was p=`r shapiro.test(residuals(total.pupae.mef.raptor.aov))$p.value`.  We also checked for equal variance between groups.  The p-value for that Levene's test was `r leveneTest(Total.Pupae~Driver*UAS, data=subset(annotated_pupae_data_mef,Gene%in%c('Control','Raptor')))$"Pr(>F)"[1]`.  

Based on this the ANOVA assumptions were met.  Therefore the p-value for effect of genotype on total pupae is **`r summary(total.pupae.mef.raptor.aov)[[1]][["Pr(>F)"]][2]`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *C179/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Total.Pupae~Driver, subset(annotated_pupae_data_mef, UAS==36304&Gene%in%c('Control','Raptor')))$p.value`**.  These data indicatee that there was no significant effect on the number of pupae.


### Analysis of Dead Pupae

```{r mef-dead-pupae-statistics, echo=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
dead.pupae.aov.mef <- aov(Dead.Pupae.pct~Driver*UAS, data=annotated_pupae_data_mef)
dead.pupae.aov.mef.no.wt <- aov(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'))
dead.pupae.kw.mef.no.wt <- kruskal.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'))
#did dunnet test vs the control
library(multcomp)
pupae.dunnett_mef <- glht(dead.pupae.aov.mef.no.wt, linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
pupae.dunnett.summary_mef <- cbind(summary(pupae.dunnett_mef)$test$coefficients, summary(pupae.dunnett_mef)$test$pvalues)
colnames(pupae.dunnett.summary_mef) <- c("Effect Size (%)", "p-value")

#did wilcoxon tests vs the control
dead.pupae.wilcoxon.summary <- data.frame(row.names=levels(annotated_pupae_data_mef$UAS))

for (uas in levels(annotated_pupae_data_mef$UAS)){
  if (uas %in% c('36304','35144')){
  dead.pupae.wilcoxon.summary[uas,'pval'] <- NA
    }
else
  dead.pupae.wilcoxon.summary[uas,'pval'] <- wilcox.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=="Mef-Gal4" & UAS %in% c('36304',uas)))$p.value
}
dead.pupae.wilcoxon.summary$padj <- p.adjust(dead.pupae.wilcoxon.summary$pval, method="BH")


#For raptor knockdowns only
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
dead.pupae.aov.mef.raptor <- aov(Dead.Pupae.pct~Driver*UAS, data=subset(annotated_pupae_data_mef, Gene %in% c("Control","Raptor")))
dead.pupae.aov.mef.raptor.no.wt <- aov(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'& Gene %in% c("Control","Raptor")))


#did kruskal wallis tests
dead.pupae.kw.mef.raptor.no.wt <- kruskal.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'& Gene %in% c("Control","Raptor")))

#did dunnet test vs the control

pupae.dunnett_mef_raptor <- glht(dead.pupae.aov.mef.raptor.no.wt, linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
pupae.dunnett.summary_mef_raptor <- cbind(summary(pupae.dunnett_mef_raptor)$test$coefficients, summary(pupae.dunnett_mef_raptor)$test$pvalues)
colnames(pupae.dunnett.summary_mef_raptor) <- c("Effect Size (%)", "p-value")


#did wilcoxon tests vs the control
dead.pupae.wilcoxon.summary.raptor <- data.frame(row.names=c('31528','34814'))

for (uas in c('31528','34814')){
  dead.pupae.wilcoxon.summary.raptor[uas,'pval'] <- wilcox.test(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=="Mef-Gal4" & UAS %in% c('36304',uas)))$p.value
}
dead.pupae.wilcoxon.summary.raptor$padj <- p.adjust(dead.pupae.wilcoxon.summary.raptor$pval, method="BH")
```

A summary of the percent of dead pupae for each cross is shown below:

```{r mef-dead-pupae-summary-tables,echo=FALSE,results='asis', message=FALSE}
print(xtable(dead_pupae_summary_mef, caption="Summary of Percent of Dead Pupae by Driver and UAS for Mef-GAL4", label="tab:dead-pupae-summary-mef"), include.rownames=F, type='html')
```

```{r dead-pupae-barplot-mef,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(100)
plot <- barplot(dead_pupae_summary_mef$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=dead_pupae_summary_mef$UAS,
        col=dead_pupae_summary_mef$Gene,
        ylab="Percent of Dead Pupae",
        xlab="shRNA Clone",
        main="Percent of Dead Pupae Using the Mef-GAL4 Driver")

legend("topleft", levels(dead_pupae_summary_mef$Gene), fill= palette()[1:length(levels(dead_pupae_summary_mef$Gene))], bty='n')

superpose.eb(plot, 
             dead_pupae_summary_mef$mean,
             dead_pupae_summary_mef$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of dead pupae.  To test for normality we did a Shapiro-Wilk test (p=`r shapiro.test(residuals(dead.pupae.aov.mef))$p.value`) and to test for equal variance we did a Levene's test (p=`r leveneTest(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'))$"Pr(>F)"[1]`).  Since normality but equal variance was not we did a Kruskal-Wallis test.

The p-value for that comparason is **`r dead.pupae.kw.mef.no.wt$p.value`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *Mef/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Dead.Pupae.pct~Driver, subset(annotated_pupae_data_mef, UAS=36304),var.equal=F)$p.value`**.  We therefore excluded the +/+ progeny from the analysis and compared with the *Mef-Gal4/+* progeny as a control.  

Since the Kruskal-Wallis test was significant, we did a post-hoc test to look at each strain relative to the control.  To test for differences compared to the *Mef-GAL4/+* control strain, we did a Wilcoxon Rank Sum tests.  The range was `r (min(dead_pupae_summary_mef$mean[2:3])-dead_pupae_summary_mef$mean[1])/dead_pupae_summary_mef$mean[1]`-`r (max(dead_pupae_summary_mef$mean[2:3])-dead_pupae_summary_mef$mean[1])/dead_pupae_summary_mef$mean[1]` times more dead pupae. The results of this test are shown in the table below.  


```{r mef-dead-pupae-dunnett-tables,echo=FALSE,results='asis', message=FALSE}
#print(xtable(pupae.dunnett.summary_mef, caption="Dunnett's Test for the Percent of Dead Pupae Comparing to Control (Mef-Gal4/+)", label="tab:dead-pupae-dunnett-mef", digits=c(0,1,15)), type='html')
print(xtable(dead.pupae.wilcoxon.summary, caption="Wilcoxon Rank Sum Tests for the Percent of Dead Pupase Comparing to Control (Mef-Gal4/+)", digits =c(0,4,4)),type='html')
```



#### Raptor Knockdown Only

```{r mef-raptor-dead-pupae-summary-tables,echo=FALSE,results='asis', message=FALSE}
print(xtable(dead_pupae_summary_mef_raptor, caption="Summary of Percent of Dead Pupae by Driver and UAS for Mef-GAL4", label="tab:dead-pupae-summary-mef"), include.rownames=F, type='html')
```

```{r mef-raptor-dead-pupae-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(100)
plot <- barplot(dead_pupae_summary_mef_raptor$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=dead_pupae_summary_mef_raptor$UAS,
        col=dead_pupae_summary_mef_raptor$Gene,
        ylab="Percent of Dead Pupae",
        xlab="shRNA Clone",
        main="Percent of Dead Pupae Using the Mef-GAL4 Driver")

legend("topleft", levels(dead_pupae_summary_mef_raptor$Gene)[1:2], fill= palette()[1:2], bty='n')

superpose.eb(plot, 
             dead_pupae_summary_mef_raptor$mean,
             dead_pupae_summary_mef_raptor$se)
```


To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the percentage of dead pupae.  To test for normality we did a Shapiro-Wilk test (p=`r shapiro.test(residuals(dead.pupae.aov.mef.raptor.no.wt))$p.value`) and to test for equal variance we did a Levene's test (p=`r leveneTest(Dead.Pupae.pct~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'&Gene %in% c("Control","Raptor")))$"Pr(>F)"[1]`).  Since normality was met, but equal variance was not we did a Kruskal-Wallis test.

The p-value for that comparason is **`r dead.pupae.kw.mef.raptor.no.wt$p.value`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *Mef/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Dead.Pupae.pct~Driver, subset(annotated_pupae_data_mef, UAS=36304),var.equal=F)$p.value`**.  We therefore excluded the +/+ progeny from the analysis and compared with the *Mef-Gal4/+* progeny as a control.  

Since this Kruskal-Wallis test was significant, we did a post-hoc Wilcoxon tests to look at each strain relative to the control.  The range was `r (min(dead_pupae_summary_mef$mean[2:3])-dead_pupae_summary_mef$mean[1])/dead_pupae_summary_mef$mean[1]`-`r (max(dead_pupae_summary_mef$mean[2:3])-dead_pupae_summary_mef$mean[1])/dead_pupae_summary_mef$mean[1]` times more dead pupae. The results of this test are shown in the table below.  

```{r mef-raptor-dead-pupae-wilcoxon-tables,echo=FALSE,results='asis', message=FALSE}
print(xtable(dead.pupae.wilcoxon.summary.raptor, caption="Wilcoxon Rank Sum Tests for the Percent of Dead Pupae Comparing to Control (Mef-Gal4/+)", label="tab:dead-pupae-dunnett-mef", digits=c(0,5,5)), type='html')
```
dead.pupae.wilcoxon.summary

### Analysis of Total Number of Flies

```{r mef-total-fly-statistics, echo=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
total.flies.aov_mef <- aov(Live.Flies~Driver*UAS, data=annotated_pupae_data_mef)
restricted.flies.aov_mef <- aov(Live.Flies~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'))

total.flies.raptor.aov_mef <- aov(Live.Flies~Driver*UAS, data=subset(annotated_pupae_data_mef, Gene %in% c('Control','Raptor')))
restricted.flies.raptor.aov_mef <- aov(Live.Flies~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'&Gene %in% c('Control','Raptor')))

restricted.flies.raptor.kw_mef <- kruskal.test(Live.Flies~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'&Gene %in% c('Control','Raptor')))

total.flies.wilcoxon.summary <- data.frame(row.names=c('31528','34814'))

for (uas in c('31528','34814')){
  total.flies.wilcoxon.summary[uas,'pval'] <- wilcox.test(Live.Flies~UAS, data=subset(annotated_pupae_data_mef, Driver=="Mef-Gal4" & UAS %in% c('36304',uas)))$p.value
}
total.flies.wilcoxon.summary$padj <- p.adjust(total.flies.wilcoxon.summary$pval, method="BH")

total.flies.dunnett_mef <- glht(restricted.flies.aov_mef , linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
fly.dunnett.summary_mef <- cbind(summary(total.flies.dunnett_mef)$test$coefficients, summary(total.flies.dunnett_mef)$test$pvalues)
colnames(fly.dunnett.summary_mef) <- c("Effect Size (%)", "p-value")
```

We inspected the total number of flies eclosed up to 21 days after the cross was set up.  These data are summarized in the  table and figure below:

```{r mef-total-fly-summary-tables,echo=FALSE,results='asis'}
print(xtable(total_fly_summary_mef, caption="Summary of the Number of Flies by Driver and UAS for Mef-GAL4", label="tab:total-flies-summary-mef"), include.rownames=F, type='html')
```

```{r mef-total-fly-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_fly_summary_mef$mean+total_fly_summary_mef$se, na.rm=T)
plot <- barplot(total_fly_summary_mef$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary_mef$UAS,
        col=total_fly_summary_mef$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Flies for the Mef-GAL4 Driver")

legend("top", levels(total_fly_summary_mef$Gene), fill= palette()[1:length(levels(total_fly_summary_mef$Gene))], bty='n')

superpose.eb(plot, 
             total_fly_summary_mef$mean,
             total_fly_summary_mef$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  We did a Shaprio-Wilk test to check for normality (p=`r shapiro.test(residuals(total.flies.aov_mef))$p.value`) and a Levene's Test to check for equal variance (p=`r leveneTest(Live.Flies~Driver*UAS, data=annotated_pupae_data_mef)$"Pr(>F)"[1]`).  A Levene's Test if we remove the +/+ control gives a p-value of `r leveneTest(Live.Flies~UAS, data=subset(annotated_pupae_data_mef, Driver=="Mef-Gal4"))$"Pr(>F)"[1]` and the Shapiro-Wilk test was p=`r shapiro.test(residuals(restricted.flies.aov_mef))$p.value`, so using that model, the assumptions of normality and equal variance are met.

The p-value for that comparason is **`r summary(restricted.flies.aov_mef)[[1]][["Pr(>F)"]][2]`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *Mef/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Live.Flies~Driver, subset(annotated_pupae_data_mef, UAS=36304), var.equal=F)$p.value`**.  

Due to the significant ANOVA we performed a post-hoc Dunnett's test using the *Mef/+* progeny as the controls.  An ANOVA analysis excluding the +/+ flies had a p-value of **`r summary(restricted.flies.aov_mef)[[1]][["Pr(>F)"]][1]`** for the UAS.  A Dunnett's test results are shown below.

```{r mef-total-fly-dunnett-tables,echo=FALSE,results='asis'}
print(xtable(fly.dunnett.summary_mef, caption="Dunnett's Test for the Number of Flies Comparing to Control (Mef-Gal4/+)", label="tab:total-flies-dunnett-mef", digits=c(0,1,7)), type='html')
```

#### Raptor Knockdown Flies Only

```{r mef-raptor-total-fly-summary-tables,echo=FALSE,results='asis'}
print(xtable(total_fly_summary_mef_raptor, caption="Summary of the Number of Flies by Driver and UAS for Mef-GAL4", label="tab:total-flies-summary-mef"), include.rownames=F, type='html')
```

```{r mef-raptor-total-fly-barplot,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
ymax <- max(total_fly_summary_mef_raptor$mean+total_fly_summary_mef_raptor$se, na.rm=T)
plot <- barplot(total_fly_summary_mef_raptor$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary_mef_raptor$UAS,
        col=total_fly_summary_mef_raptor$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Flies for the Mef-GAL4 Driver")

legend("top", levels(total_fly_summary_mef_raptor$Gene)[1:2], fill= palette()[1:2], bty='n')

superpose.eb(plot, 
             total_fly_summary_mef_raptor$mean,
             total_fly_summary_mef_raptor$se)
```

To analyse these data, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  We did a Shaprio-Wilk test to check for normality (p=`r shapiro.test(residuals(total.flies.aov_mef))$p.value`) and a Levene's Test to check for equal variance (p=`r leveneTest(Live.Flies~Driver*UAS, data=annotated_pupae_data_mef)$"Pr(>F)"[1]`).  A Levene's Test if we remove the +/+ control gives a p-value of `r leveneTest(Live.Flies~UAS, data=subset(annotated_pupae_data_mef, Driver=="Mef-Gal4"))$"Pr(>F)"[1]` and the Shapiro-Wilk test was p=`r shapiro.test(residuals(restricted.flies.aov_mef))$p.value`, so using that model, neither the assumptions of normality and equal variance are met.

We therefore did a Kruskal-Wallis omnibus test, the p-value for that comparason is **`r restricted.flies.raptor.kw_mef$p.value`** for the UAS.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *Mef/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Live.Flies~Driver, subset(annotated_pupae_data_mef, UAS=36304), var.equal=F)$p.value`**.  

Due to the significant Kruskal-Wallis test we performed post-hoc Wilcoxon tests using the *Mef/+* progeny as the controls.  

```{r mef-raptor-total-fly-dunnett-tables,echo=FALSE,results='asis'}
print(xtable(total.flies.wilcoxon.summary, caption="Wilcoxon Tests for the Number of Flies Comparing to Control (Mef-Gal4/+)", label="tab:total-flies-dunnett-mef", digits=c(0,1,7)), type='html')
```

### Analysis of Number of Flies by Gender

```{r mef-total-fly-statistics-gender, echo=FALSE}
#perform anova testing first for an effect of the driver, then for an effect of the shRNAs
total.flies.aov.males_mef <- aov(Males~Driver*UAS, data=annotated_pupae_data_mef)
total.flies.aov.females_mef <- aov(Females~Driver*UAS, data=annotated_pupae_data_mef)

restricted.flies.aov.males_mef <- aov(Males~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'))
restricted.flies.aov.females_mef <- aov(Females~UAS, data=subset(annotated_pupae_data_mef, Driver=='Mef-Gal4'))

total.flies.dunnett.males_mef <- glht(restricted.flies.aov.males_mef , linfct=mcp(UAS="Dunnett"))
total.flies.dunnett.females_mef <- glht(restricted.flies.aov.females_mef , linfct=mcp(UAS="Dunnett"))
#made a table with the dunnet test results
fly.dunnett.summary.gendered_mef <- cbind(summary(total.flies.dunnett.males_mef)$test$coefficients, 
                             summary(total.flies.dunnett.males_mef)$test$pvalues,
                             summary(total.flies.dunnett.females_mef)$test$coefficients, 
                             summary(total.flies.dunnett.females_mef)$test$pvalues)
colnames(fly.dunnett.summary.gendered_mef) <- c("Male Effect Size (%)", "Male p-value","Female Effect Size (%)", "Female p-value")
```

For the flies which had been born, we could separate these data based on gender.  The separated data is summarized in Tables \ref{tab:total-flies-summary-males} and \ref{tab:total-flies-summary-females}.  These data are graphed in Figure \ref{fig:total-flies-barplot-gendered}.  

For Males, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  The p-value for that comparason is **`r summary(total.flies.aov.males_mef)[[1]][["Pr(>F)"]][2]`** for the UAS.  The results of this ANOVA are shown in Table \ref{tab:total-flies-anova-males-mef}.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *Mef/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Males~Driver, subset(annotated_pupae_data_mef, UAS=36304))$p.value`**. 

For Females, first we did an ANOVA testing for whether the UAS has an effect on the number of eclosed flies.  The p-value for that comparason is **`r summary(total.flies.aov.females_mef)[[1]][["Pr(>F)"]][2]`** for the UAS.  The results of this ANOVA are shown in Table \ref{tab:total-flies-anova-females}.  To test if the driver alone had an effect with did a Student's t-test comparing the +/+ and *Mef/+* progeny.  The p-value for the Driver having an effect is **`r t.test(Females~Driver, subset(annotated_pupae_data_mef, UAS=36304))$p.value`**. 

Due to the significant ANOVA we performed a post-hoc Dunnett's test using the *Mef/+* progeny as the controls.  An ANOVA analysis excluding the +/+ flies had a p-value of **`r summary(restricted.flies.aov.males_mef)[[1]][["Pr(>F)"]][1]`** for the UAS for males and a p-value of **`r summary(restricted.flies.aov.females_mef)[[1]][["Pr(>F)"]][1]`** for the UAS for the females.  The results of that test are in Tables \ref{tab:total-flies-dunnett-gendered}.  This test indicates that each of the three Raptor shRNA knockdowns cause a reduction in the number of male flies, but only 34814 had significantly less females.

```{r mef-total-fly-summary-gender-tables,echo=FALSE,results='asis'}
print(xtable(total_fly_summary_males_mef, caption="Summary of the Number of Male Flies by Driver and UAS for Mef-GAL4", label="tab:total-flies-summary-males-mef"), include.rownames=F, type='html')
print(xtable(total_fly_summary_females_mef, caption="Summary of the Number of Female Flies by Driver and UAS for Mef-GAL4", label="tab:total-flies-summary-females-mef"), include.rownames=F, type='html')
print(xtable(total.flies.aov.males_mef, caption="ANOVA for the Number of Male Flies by Driver and UAS for Mef-GAL4", label="tab:total-flies-anova-males-mef"), type='html')
print(xtable(total.flies.aov.females_mef, caption="ANOVA for the Number of Female Flies by Driver and UAS for Mef-GAL4", label="tab:total-flies-anova-females-mef"), type='html')
print(xtable(fly.dunnett.summary.gendered_mef, caption="Dunnett's Test for the Number of Males and Females Comparing to Control (Mef-Gal4/+)", label="tab:total-flies-dunnett-gendered-mef", digits=c(0,1,7,1,7)), type='html')
```

```{r mef-total-fly-barplot-gendered,fig=TRUE,echo=FALSE, dev=c('png','pdf')}
par(mfrow=c(2,1))
ymax <- max(total_fly_summary_males_mef$mean+total_fly_summary_males_mef$se, na.rm=T)
plot <- barplot(total_fly_summary_males_mef$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary_males_mef$UAS,
        col=total_fly_summary_males_mef$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Male Flies")

legend("top", levels(total_fly_summary_males_mef$Gene), fill= palette()[1:length(levels(total_fly_summary_males_mef$Gene))], bty='n')

superpose.eb(plot, 
             total_fly_summary_males_mef$mean,
             total_fly_summary_males_mef$se)

ymax <- max(total_fly_summary_females_mef$mean+total_fly_summary_females_mef$se, na.rm=T)
plot <- barplot(total_fly_summary_females_mef$mean,
        beside=T, las=1,
        ylim=c(0,ymax),
        names.arg=total_fly_summary_females_mef$UAS,
        col=total_fly_summary_females_mef$Gene,
        ylab="Total Number of Flies",
        xlab="shRNA Clone",
        main="Total Number of Female Flies")

superpose.eb(plot, 
             total_fly_summary_females_mef$mean,
             total_fly_summary_females_mef$se)
```

## Session Information
```{r sessionInfo, echo=F}
sessionInfo()
```