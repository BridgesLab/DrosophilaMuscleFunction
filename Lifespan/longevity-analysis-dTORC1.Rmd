# Analysis of Longevity from Muscle TSC1/Raptor Flies

## Experimental Design

```{r data-input, echo=FALSE}
require(RCurl, quietly=T)
require(lubridate, quietly=T)
birth_worksheet <- 'https://docs.google.com/spreadsheet/pub?key=0Aitfmor6rCjYdFZsdGpxcmhLX2lNd2lNWUN6T014Qnc&output=csv' 
death_worksheet <- 'https://docs.google.com/spreadsheet/pub?key=0Am2qM2oZ12_jdHd3RTdVUjNuQWxtYmV1S2laR3M4Znc&single=true&gid=0&output=csv'
second_death_worksheet <- 'https://docs.google.com/spreadsheet/pub?key=0Aitfmor6rCjYdEJfSnVma0Ytd3VfTWVuWkd6elJFT2c&single=true&gid=0&output=csv'
second_birth_worksheet <- 'https://docs.google.com/spreadsheet/pub?key=0Aitfmor6rCjYdHpHTk1BZVh0MFEtNDV6QVI2V2RWSEE&single=true&gid=0&output=csv' 

mapping_data <- read.csv('../Data/gene_mapping.csv')
birth_file <- getURL(birth_worksheet)
death_file <- getURL(death_worksheet)
birth_data <- read.csv(textConnection(birth_file))
death_data <- read.csv(textConnection(death_file))

second_birth_data <- read.csv(textConnection(getURL(second_birth_worksheet)))
second_death_data <- read.csv(textConnection(getURL(second_death_worksheet)))
#sets all the second batch to have phenotype WT
second_death_data$Phenotype <- rep("WT-x", dim(second_death_data)[1])

all_death_data <- rbind(death_data, second_death_data)
useful_birth_columns <- c('CrossName','Generation','Cross','Replicate','DateStarted', 'Male', 'Female')
all_birth_data <- rbind(birth_data[,useful_birth_columns], second_birth_data[,useful_birth_columns])

data <- merge(all_death_data, all_birth_data, by='CrossName')
data$Birth.Date <- mdy(gsub("/", "-", data$Birth.Date))
data$Death.Date <- mdy(gsub("/", "-", data$Death.Date))
data$Age <- as.integer(data$Death.Date - data$Birth.Date)
data$Cross <- as.factor(paste(data$Male, data$Female, sep=" x "))
data$Driver <- as.factor(sapply(strsplit(as.character(data$Female), "/"),"[", 1))
data$UAS <- as.factor(sapply(strsplit(as.character(data$Male), "/"),"[", 1))

data <- merge(data, mapping_data)
#moved gender to being case insensitive
data$Gender <- as.factor(tolower(data$Gender))
#made genotype case insensitive
data$Phenotype <- as.factor(tolower(data$Phenotype))
data$Genotype[data$Phenotype =='wt'] <- "shRNA/GAL4"
data$Genotype[data$Phenotype == 'ser'] <- "shRNA/Tm3,sb"
data$Genotype[data$Phenotype == 'sb'] <- "shRNA/Tm3,sb"
data$Genotype[data$Phenotype == 'tm6b'] <- "GAL4/Tm6B"
data$Genotype[data$Phenotype == 'tm6b/ser'] <- "Tm3,sb/Tm6B"
data$Genotype[data$Phenotype == 'tm6b/sb'] <- "Tm3,sb/Tm6B"
#set ones with females as 36304 to be +/+
data$Genotype[data$Driver =='36304'] <- "+/+"
#set the ones with the male as control but the driver not as control to be GAL4/+
data$Genotype[data$Driver !='36304'&data$UAS =='36304'] <- "GAL4/+"
#set the remaining wt-x to be shRNA/GAL4
data$Genotype[data$Genotype == NA&data$Phenotype=='wt-x'] <- 'shRNA/GAL4'
#made genotype into a factor
data$Genotype <- as.factor(data$Genotype)
#set levels of genotype
data$Genotype <- relevel(data$Genotype, ref="shRNA/GAL4")

#sets blank Accidentals to be false
data[is.na(data$Accidental),]$Accidental <- FALSE

data <- droplevels(data)
write.csv(data, "../Data/Longevity Analysis Data.csv")
```

These data are stored in the \textbf{Data` subfolder.  This script was most recently run on `r date()`.  There has been a total of \textbf{`r dim(death_data)[1]` deaths, with \textbf{`r dim(death_data[death_data$Accidental==FALSE,])[1]` of natural causes and \textbf{`r dim(death_data[death_data$Phenotype!='?'&death_data$Accidental==FALSE,])[1]` of identifiable genotypes excluding accidental deaths.  The oldest fly recorded so far was \textbf{`r  max(data$Age, na.rm=T)` days old at time of death.

```{r histogram-gender,fig=TRUE,echo=FALSE}
with(data[data$Accidental==FALSE&data$Gender=='female'&data$Genotype!='Tm3/Tm6B'&data$Genotype!='NA',], plot(density(Age, na.rm=T), main="Natural Death Distribution, all Control Flies", col="red", las=1, xlab=""))
with(data[data$Accidental==FALSE&data$Gender=='male'&data$Genotype!='Tm3/Tm6B'&data$Genotype!='NA',], lines(density(Age, na.rm=T), col="black", las=1))
legend("topright", c("Male","Female"), lty=1, col=c("black","red"), bty="n")
```

```{r histogram-controls,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(2,1))
require(RColorBrewer)
genotype.colors <- brewer.pal(7, 'Set2')
with(data[data$Accidental==FALSE&data$Gender=='female'&data$Genotype==levels(data$Genotype)[3],], plot(density(Age, na.rm=T), main="Natural Death Distribution - Female Controls", col=genotype.colors[3], las=1, xlab=""))
with(data[data$Accidental==FALSE&data$Gender=='female'&data$Genotype==levels(data$Genotype)[2],], lines(density(Age, na.rm=T),  col=genotype.colors[2]))
legend("topleft", levels(data$Genotype)[c(3,2)], lty=1, bty="n", col=genotype.colors[c(3,2)])

with(data[data$Accidental==FALSE&data$Gender=='male'&data$Genotype==levels(data$Genotype)[2],], plot(density(Age, na.rm=T), main="Natural Death Distribution - Male Controls", col=genotype.colors[2], las=1, xlab="", xlim=c(0,110)))
with(data[data$Accidental==FALSE&data$Gender=='male'&data$Genotype==levels(data$Genotype)[3],], lines(density(Age, na.rm=T), col=genotype.colors[3]))
legend("topleft", levels(data$Genotype)[c(2,3)], lty=1, bty="n", col=genotype.colors[c(2,3)])
```



### Gene Level Analysis

```{r summary-statistics, echo=FALSE}
require(plyr)
require(reshape2)

complete.data <- data[!(is.na(data$Age))&!(is.na(data$Genotype)),]

summarised.data.all <- ddply(complete.data, .(Driver,UAS,Genotype), summarise,
                         Deaths = length(Age),
                         Median.Age = median(Age),
                         Age= mean(Age),
                         Error = sd(Age, na.rm=T)/sqrt(length(Age)))
summarised.data.natural <- ddply(data[data$Accidental==FALSE,], .(Driver,UAS,Genotype), summarise,
                         Deaths = length(Age),
                         Median.Age = median(Age),
                         Age= mean(Age),
                         Error = sd(Age, na.rm=T)/sqrt(length(Age)))

summarised.data.natural.genes <- ddply(complete.data[complete.data$Accidental==FALSE&complete.data$Genotype!='shRNA/GAL4',], .(UAS,Driver,Gene,Genotype), summarise,
                         Deaths = length(Age),
                         Median.Age = median(Age, na.rm=T),
                         Age= mean(Age, na.rm=T),
                         Error = sd(Age, na.rm=T))

summarised.data.natural.gene <- ddply(data[data$Accidental==FALSE,], .(Driver,Gene,Genotype), summarise,
                         Deaths = length(Age),
                         Median.Age = median(Age),
                         Age= mean(Age),
                         Error = sd(Age, na.rm=T)/sqrt(length(Age)))
summarised.data.natural.gene.gender <- ddply(data[data$Accidental==FALSE,], .(Driver,Gene,Genotype,Gender), summarise,
                         Deaths = length(Age),
                         Median.Age = median(Age),
                         Age= mean(Age),
                         Error = sd(Age, na.rm=T)/sqrt(length(Age)))
```

```{r barplot-controls,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
median.summary <- dcast(subset(summarised.data.natural.genes, Deaths>20), Driver+UAS~Genotype, value.var='Median.Age', mean, na.rm=T)
barplot(as.matrix(median.summary[3:5]), beside=T, col=median.summary$Driver, las=1, main="Median Age of Controls by UAS")
legend("topleft", levels(median.summary$Driver), fill=palette()[1:4], bty="n")
```


## Number of Flies Examined

The total number of deaths for each cross and genotype ,removing deaths that were accidental or not due to natural causes, the data is shown in Table \ref{tab:analysed-deaths-gene} and \ref{tab:analysed-deaths-gene-gender}.

The distribution of deaths in the samples are shown at a gender level in Figure \ref{fig:histogram-genders} and looking at the controls in Figure \ref{fig:histogram-controls}.  To examine the controls, and whether there are effects of the GAL4 or the shRNA we examined the median age of the controls from each cross.  These data are shown in Figure \ref{fig:barplot-controls}.  Still need to do some statistics to test if this is relevant.

```{r selected-data,echo=FALSE,results='asis'}
require(xtable)
print(xtable(dcast(summarised.data.natural.gene, Driver+Gene~Genotype, value.var='Deaths', margins=F, sum), caption = "Total Natural Deaths for Each Gene and Genotype", label = "tab:analysed-deaths-gene"), include.rownames=F)
print(xtable(dcast(summarised.data.natural.gene.gender, Driver+Gene+Gender~Genotype, value.var='Deaths', margins=F, sum), caption = "Total Natural Deaths by Gender for Each Gene and Genotype", label = "tab:analysed-deaths-gene-gender"), include.rownames=F)
```

# Survival Analysis

All of these are relative to the reference Genotype which is the knockdown (GAL4/shRNA).  
\
## 24B-Gal4 Driver Analysis
This analysis is only for the three *Tsc1* shRNA alleles, since there were so few births in the *Raptor* knockdown alleles.  The summary statistics from this analysis are shown in Table \ref{tab:coxph-summary-24b}.

```{r survival-analysis-24b, echo=FALSE, dev=c('pdf','png')}
require(survival)
summary.coxph.24b.gene <- data.frame(row.names=c('Tsc1'), 
                                n=rep(NA,1), 
                                logtest.p=rep(NA,1),
                                waldtest.p=rep(NA,1),
                                sctest.p=rep(NA,1))

    data.used <- droplevels(data[data$Driver=='24B-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    #print(sprintf('Analysis of %s with 24B-GAL4 Driver', gene))
    #print(survfit(survobj~Genotype, data=data.used), print.rmean=TRUE)
    coxph.fit <- coxph(survobj~Genotype, data=data.used)
    beta <- coef(coxph.fit)
    se <- sqrt(diag(coxph.fit$var))
    assign(paste('coxph.table.24b','Tsc1',sep='.'),data.frame(Coef=beta, 
                              SE = se,
                              Hazard.Ratio = 1/exp(beta),
                              p = 1 - pchisq((beta/se)^2, 1)))
    
    summary.coxph.24b.gene['Tsc1',] <- c(
      n=coxph(survobj~Genotype, data=data.used)$nevent,
      logtest.p=summary(coxph(survobj~Genotype, data=data.used))$logtest[3],
      waldtest.p=summary(coxph(survobj~Genotype, data=data.used))$wald[3],
      sctest.p=summary(coxph(survobj~Genotype, data=data.used))$sctest[3])
    #summary.coxph.24b$padj <- p.adjust(summary.coxph.24b$logrank.p,n=3,method="BH")
    
    pdf(sprintf('figure/24B-%s-survival-plot.pdf', 'Tsc1'))
    plot(survfit, main = sprintf('Survival of %s with 24B-GAL4 Driver', 'Tsc1'),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las = 1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
    dev.off()


#Separating out genders for this analysis
summary.coxph.24b.gene.gender <- data.frame(
                row.names=paste(c("Tsc1","Tsc1"),c("male","female")),
                n=rep(NA,2), 
                logtest.p=rep(NA,2),
                waldtest.p=rep(NA,2),
                sctest.p=rep(NA,2))

#iterate over gender, then over each gene
for (gender in levels(data$Gender)) {
        data.used <- droplevels(data[data$Driver=='24B-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender==gender,])
        survobj <- with(data.used, Surv(Age, Accidental==FALSE))
        survfit <- survfit(survobj~Genotype, data=data.used)
        #print(survfit(survobj~Genotype, data=data.used), print.rmean=TRUE)
        #print(coxph(survobj~Genotype, data=data.used))
        
        coxph.fit <- coxph(survobj~Genotype, data=data.used)
        beta <- coef(coxph.fit)
        se <- sqrt(diag(coxph.fit$var))
        assign(paste(paste('coxph.table.24b','Tsc1',sep='.'),gender, sep="."),
               data.frame(Coef=beta, 
                              SE = se,
                              Hazard.Ratio = 1/exp(beta),
                              p = 1 - pchisq((beta/se)^2, 1)))
        
        summary.coxph.24b.gene.gender[paste('Tsc1', gender),] <- c(
          n=coxph(survobj~Genotype, data=data.used)$nevent,
          logtest.p=summary(coxph(survobj~Genotype, data=data.used))$logtest[3],
          waldtest.p=summary(coxph(survobj~Genotype, data=data.used))$wald[3],
          sctest.p=summary(coxph(survobj~Genotype, data=data.used))$sctest[3])
        #summary.coxph.24b$padj <- p.adjust(summary.coxph.24b$logrank.p,n=3,method="BH")
        pdf(sprintf('figure/24B-%s-survival-plot.pdf', paste('Tsc1',gender,sep="-")))
        plot(survfit, main = sprintf('Survival of %s with 24B-GAL4 Driver', paste('Tsc1',gender)),
             xlab= 'Days',
             ylab= 'Percent Survival',
             yscale=100, 
             las = 1,
             lty=c(1,2,2,2),
             col= genotype.colors)
        legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2,2), bty="n")
        dev.off()
}
```

```{r coxph-datatables-24b,echo=FALSE,results='asis'}
print(xtable(summary.coxph.24b.gene, digits=c(0,0,5,5,5),caption = "Gene Level Tests for 24B-Gal4 Drivers", label = "tab:coxph-summary-24b"), type='html')
print(xtable(summary.coxph.24b.gene.gender, digits=c(0,0,15,5,5),caption = "Gene and Gender Level  Tests for 24B-Gal4 Drivers", label = "tab:coxph-summary-24b-gender"), type='html')

print(xtable(coxph.table.24b.Tsc1, digits=c(0,3,3,3,15),caption = "Gene Level Cox Proportional Hazard Tests for 24B-Gal4 Drivers and Tsc1 Knockdown", label = "tab:coxph.table.24b.tsc1"), type='html')
print(xtable(coxph.table.24b.Tsc1.male, digits=c(0,3,3,3,15),caption = "Gene Level Cox Proportional Hazard Tests for Males with 24B-Gal4 Drivers and Tsc1 Knockdown", label = "tab:coxph.table.24b.tsc1.male"), type='html')
print(xtable(coxph.table.24b.Tsc1.female, digits=c(0,3,3,3,17),caption = "Gene Level Cox Proportional Hazard Tests for Females with 24B-Gal4 Drivers and Tsc1 Knockdown", label = "tab:coxph.table.24b.tsc1.female"), type='html')
```

```{r survival-24b-tsc, echo=FALSE, dev=c('pdf','png')}
    data.used <- droplevels(data[data$Driver=='24B-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3,sb/Tm6B',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Survival of Tsc1 shRNA Flies with 24B-GAL4 Driver',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las = 1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```

```{r survival-24b-tsc-gender,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(1,2))
    data.used <- droplevels(data[data$Driver=='24B-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='male',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Males',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las = 1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='24B-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='female',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Females',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las = 1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```


We performed a variety of survival tests for the was a 24B-Gal4 driven *Tsc1* knockdowns (see Tables \ref{tab:coxph-summary-24b} and \ref{tab:coxph-summary-24b-gender}).  These tests removed the Tm3/Tm6B flies, which in all cases died prematurely.  The logrank test was highly significant (p=`r summary.coxph.24b.gene['Tsc',]$logtest.p`) for the combined comparasons and both males (p=`r summary.coxph.24b.gene.gender['Tsc1 male','logtest.p']`) and females (p=`r summary.coxph.24b.gene.gender['Tsc1 female','logtest.p']`).

For post-hoc testing, we performed cox proportional hazard tests, shown in Tables \ref{tab:coxph.table.24b.tsc1}, \ref{tab:coxph.table.24b.tsc1.male} and \ref{tab:coxph.table.24b.tsc1.female}.  All comparasons were highly significant all less than `r max(rbind(coxph.table.24b.Tsc1.male,coxph.table.24b.Tsc1.female)$p)`.  The instantaneous hazard ratios ranged from `r min(rbind(coxph.table.24b.Tsc1.male,coxph.table.24b.Tsc1.female)$Hazard.Ratio)` to `r max(rbind(coxph.table.24b.Tsc1.male,coxph.table.24b.Tsc1.female)$Hazard.Ratio)`, in terms of that much less likely to die than the knockdown flies.  These results are presented graphically in Figures \ref{fig:survival-24b-tsc1} and \ref{fig:survival-24b-tsc1-gender}.

## C179 Driver Analysis

This analysis is only for the three \textit{Raptor} shRNA alleles, since we did not examine the effects of Tsc1 knockdown with this driver.  The summary statistics from this analysis are shown in Table \ref{tab:coxph-summary-c179}.

```{r survival-analysis-c179, echo=FALSE}
genes <- c('Raptor','Control')
summary.coxph.c179.gene <- data.frame(row.names=c('Raptor'), 
                                n=rep(NA,1), 
                                logtest.p=rep(NA,1),
                                waldtest.p=rep(NA,1),
                                sctest.p=rep(NA,1))

    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%genes&data$Genotype!='Tm3/Tm6B',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    coxph.fit <- coxph(survobj~Genotype, data=data.used)
    beta <- coef(coxph.fit)
    se <- sqrt(diag(coxph.fit$var))
    assign(paste('coxph.table.c179','Raptor',sep='.'),data.frame(Coef=beta, 
                              SE = se,
                              Hazard.Ratio = 1/exp(beta),
                              p = 1 - pchisq((beta/se)^2, 1)))
    
    summary.coxph.c179.gene['Raptor',] <- c(
      n=coxph(survobj~Genotype, data=data.used)$nevent,
      logtest.p=summary(coxph(survobj~Genotype, data=data.used))$logtest[3],
      waldtest.p=summary(coxph(survobj~Genotype, data=data.used))$wald[3],
      sctest.p=summary(coxph(survobj~Genotype, data=data.used))$sctest[3])
    
    pdf(sprintf('figure/C179-%s-survival-plot.pdf', 'Raptor'))
    plot(survfit, main = sprintf('Survival of %s with C179-GAL4 Driver', 'Raptor'),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las = 1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
    dev.off()


#Separating out genders for this analysis
summary.coxph.c179.gene.gender <- data.frame(
                row.names=paste(c("Raptor","Raptor"),c("male","female")),
                n=rep(NA,2), 
                logtest.p=rep(NA,2),
                waldtest.p=rep(NA,2),
                sctest.p=rep(NA,2))

#iterate over gender, then over each gene
for (gender in levels(data$Gender)) {
        data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%genes&data$Genotype!='Tm3/Tm6B'&data$Gender==gender,])
        survobj <- with(data.used, Surv(Age, Accidental==FALSE))
        survfit <- survfit(survobj~Genotype, data=data.used)
        
        coxph.fit <- coxph(survobj~Genotype, data=data.used)
        beta <- coef(coxph.fit)
        se <- sqrt(diag(coxph.fit$var))
        assign(paste(paste('coxph.table.c179','Raptor',sep='.'),gender, sep="."),
               data.frame(Coef=beta, 
                              SE = se,
                              Hazard.Ratio = 1/exp(beta),
                              p = 1 - pchisq((beta/se)^2, 1)))
        
        summary.coxph.c179.gene.gender[paste('Raptor', gender),] <- c(
          n=coxph(survobj~Genotype, data=data.used)$nevent,
          logtest.p=summary(coxph(survobj~Genotype, data=data.used))$logtest[3],
          waldtest.p=summary(coxph(survobj~Genotype, data=data.used))$wald[3],
          sctest.p=summary(coxph(survobj~Genotype, data=data.used))$sctest[3])
        #summary.coxph.c179$padj <- p.adjust(summary.coxph.c179$logrank.p,n=3,method="BH")
        pdf(sprintf('figure/C179-%s-survival-plot.pdf', paste('Raptor',gender,sep="-")))
        plot(survfit, main = sprintf('Survival of %s with C179-GAL4 Driver', paste('Raptor',gender)),
             xlab= 'Days',
             ylab= 'Percent Survival',
             yscale=100, 
             las=1,
             lty=c(1,2,2,2),
             col= genotype.colors)
        legend("bottomleft", levels(data$Genotype), col=genotype.colors, lty=c(1,2,2,2), bty="n")
        dev.off()
}

```

```{r coxph-datatables-c179,echo=FALSE,results='asis'}
print(xtable(summary.coxph.c179.gene, digits=c(0,0,5,5,5),caption = "Gene Level Tests for C179-Gal4 Drivers", label = "tab:coxph-summary-c179"), type='html')
print(xtable(summary.coxph.c179.gene.gender, digits=c(0,0,5,5,5),caption = "Gene and Gender Level  Tests for C179-Gal4 Drivers", label = "tab:coxph-summary-c179-gender"), type='html')

print(xtable(coxph.table.c179.Raptor, digits=c(0,3,3,3,3),caption = "Gene Level Cox Proportional Hazard Tests for C179-Gal4 Drivers and Raptor Knockdown", label = "tab:coxph.table.c179.raptor"), type='html')
print(xtable(coxph.table.c179.Raptor.male, digits=c(0,3,3,3,7),caption = "Gene Level Cox Proportional Hazard Tests for Males with C179-Gal4 Drivers and Raptor Knockdown", label = "tab:coxph.table.c179.raptor.male"), type='html')
print(xtable(coxph.table.c179.Raptor.female, digits=c(0,3,3,3,3),caption = "Gene Level Cox Proportional Hazard Tests for Females with C179-Gal4 Drivers and Raptor Knockdown", label = "tab:coxph.table.c179.raptor.female"), type='html')
```

```{r survival-c179-raptor,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%c('Control','Raptor')&data$Genotype!='Tm3/Tm6B',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Survival of Raptor shRNA Flies with C179-GAL4 Driver', 'Raptor'),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```

```{r survival-c179-raptor-gender,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(1,2))
    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%genes&data$Genotype!='Tm3/Tm6B'&data$Gender=='male',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Males',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%genes&data$Genotype!='Tm3/Tm6B'&data$Gender=='female',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Females',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```


We performed a variety of survival tests for the was a C179-Gal4 driven \textit{Raptor} knockdowns (see Tables \ref{tab:coxph-summary-c179} and \ref{tab:coxph-summary-c179-gender}).  These tests removed the Tm3/Tm6B flies, which in all cases died prematurely.  The logrank test was not significant (p=`r summary.coxph.c179.gene['Raptor',]$logtest.p`) for the combined comparason and females (p=`r summary.coxph.c179.gene.gender['Raptor female','logtest.p']`).  There was a significant difference with the males (p=`r summary.coxph.c179.gene.gender['Raptor male','logtest.p']`).

For post-hoc testing, we performed cox proportional hazard tests, shown in Tables \ref{tab:coxph.table.c179.raptor}, \ref{tab:coxph.table.c179.raptor.male} and \ref{tab:coxph.table.c179.raptor.female}. The instantaneous hazard ratios ranged from `r min(rbind(coxph.table.c179.Raptor.male,coxph.table.c179.Raptor.female)$Hazard.Ratio)` to `r max(rbind(coxph.table.c179.Raptor.male,coxph.table.c179.Raptor.female)$Hazard.Ratio)`, in terms of that much less likely to die than the knockdown flies.  These results are presented graphically in Figures \ref{fig:survival-c179-raptor} and \ref{fig:survival-c179-raptor-gender}.


## Hand-Gal4 Analysis

This analysis is for both the three \textit{Tsc1} and the three \textit{Raptor} shRNA alleles.  The summary statistics from this analysis are shown in Table \ref{tab:coxph-summary-hand}.

```{r survival-analysis-hand, echo=FALSE, dev=c('pdf','png')}
require(survival)
summary.coxph.hand.gene <- data.frame(row.names=levels(data$Gene), 
                                n=rep(NA,length(levels(data$Gene))), 
                                logtest.p=rep(NA,length(levels(data$Gene))),
                                waldtest.p=rep(NA,length(levels(data$Gene))),
                                sctest.p=rep(NA,length(levels(data$Gene))))

genes <- c('Tsc1','Raptor')
for (gene in genes) {
    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene==gene&data$Genotype!='Tm3/Tm6B',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    #print(sprintf('Analysis of %s with Hand-GAL4 Driver', gene))
    #print(survfit(survobj~Genotype, data=data.used), print.rmean=TRUE)
    coxph.fit <- coxph(survobj~Genotype, data=data.used)
    beta <- coef(coxph.fit)
    se <- sqrt(diag(coxph.fit$var))
    assign(paste('coxph.table.hand',gene,sep='.'),data.frame(Coef=beta, 
                              SE = se,
                              Hazard.Ratio = 1/exp(beta),
                              p = 1 - pchisq((beta/se)^2, 1)))
    
    summary.coxph.hand.gene[gene,] <- c(
      n=coxph(survobj~Genotype, data=data.used)$nevent,
      logtest.p=summary(coxph(survobj~Genotype, data=data.used))$logtest[3],
      waldtest.p=summary(coxph(survobj~Genotype, data=data.used))$wald[3],
      sctest.p=summary(coxph(survobj~Genotype, data=data.used))$sctest[3])
    #summary.coxph.hand$padj <- p.adjust(summary.coxph.hand$logrank.p,n=3,method="BH")
    
    pdf(sprintf('figure/Hand-%s-survival-plot.pdf', gene))
    plot(survfit, main = sprintf('Survival of %s with Hand-GAL4 Driver', gene),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las =1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
    dev.off()
}


#Separating out genders for this analysis
summary.coxph.hand.gene.gender <- data.frame(
                row.names=paste(c("Tsc1","Tsc1","Raptor","Raptor"),c("male","female","male","female")),
                n=rep(NA,4), 
                logtest.p=rep(NA,4),
                waldtest.p=rep(NA,4),
                sctest.p=rep(NA,4))

#iterate over gender, then over each gene
for (gender in levels(data$Gender)) {
    for (gene in genes) {
        data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene==gene&data$Genotype!='Tm3/Tm6B'&data$Gender==gender,])
        survobj <- with(data.used, Surv(Age, Accidental==FALSE))
        survfit <- survfit(survobj~Genotype, data=data.used)
        #print(survfit(survobj~Genotype, data=data.used), print.rmean=TRUE)
        #print(coxph(survobj~Genotype, data=data.used))
        
        coxph.fit <- coxph(survobj~Genotype, data=data.used)
        beta <- coef(coxph.fit)
        se <- sqrt(diag(coxph.fit$var))
        assign(paste(paste('coxph.table.hand',gene,sep='.'),gender, sep="."),
               data.frame(Coef=beta, 
                              SE = se,
                              Hazard.Ratio = 1/exp(beta),
                              p = 1 - pchisq((beta/se)^2, 1)))
        
        summary.coxph.hand.gene.gender[paste(gene, gender),] <- c(
          n=coxph(survobj~Genotype, data=data.used)$nevent,
          logtest.p=summary(coxph(survobj~Genotype, data=data.used))$logtest[3],
          waldtest.p=summary(coxph(survobj~Genotype, data=data.used))$wald[3],
          sctest.p=summary(coxph(survobj~Genotype, data=data.used))$sctest[3])
        #summary.coxph.hand$padj <- p.adjust(summary.coxph.hand$logrank.p,n=3,method="BH")
        pdf(sprintf('figure/Hand-%s-survival-plot.pdf', paste(gene,gender,sep="-")))
        plot(survfit, main = sprintf('Survival of %s with Hand-GAL4 Driver', paste(gene,gender)),
             xlab= 'Days',
             ylab= 'Percent Survival',
             yscale=100, 
             las=1,
             lty=c(1,2,2,2),
             col= genotype.colors)
        legend("bottomleft", levels(data$Genotype), col=genotype.colors, lty=c(1,2,2,2), bty="n")
        dev.off()
}
}
```

```{r coxph-datatables-hand,echo=FALSE,results='asis'}
print(xtable(summary.coxph.hand.gene, digits=c(0,0,17,5,5),caption = "Gene Level Tests for Hand-Gal4 Drivers", label = "tab:coxph-summary-hand"), type='html')
print(xtable(summary.coxph.hand.gene.gender, digits=c(0,0,17,5,5),caption = "Gene and Gender Level  Tests for Hand-Gal4 Drivers", label = "tab:coxph-summary-hand-gender"), type='html')

print(xtable(coxph.table.hand.Tsc1, digits=c(0,3,3,3,3),caption = "Gene Level Cox Proportional Hazard Tests for Hand-Gal4 Drivers and Tsc1 Knockdown", label = "tab:coxph.table.hand.tsc1"), type='html')
print(xtable(coxph.table.hand.Tsc1.male, digits=c(0,3,3,3,17),caption = "Gene Level Cox Proportional Hazard Tests for Males with Hand-Gal4 Drivers and Tsc1 Knockdown", label = "tab:coxph.table.hand.tsc1.male"), type='html')
print(xtable(coxph.table.hand.Tsc1.female, digits=c(0,3,3,3,17),caption = "Gene Level Cox Proportional Hazard Tests for Females with Hand-Gal4 Drivers and Tsc1 Knockdown", label = "tab:coxph.table.hand.tsc1.female"), type='html')

print(xtable(coxph.table.hand.Raptor, digits=c(0,3,3,3,10),caption = "Gene Level Cox Proportional Hazard Tests for Hand-Gal4 Drivers and Raptor Knockdown", label = "tab:coxph.table.hand.raptor"), type='html')
print(xtable(coxph.table.hand.Raptor.male, digits=c(0,3,3,3,10),caption = "Gene Level Cox Proportional Hazard Tests for Males with Hand-Gal4 Drivers and Raptor Knockdown", label = "tab:coxph.table.hand.raptor.male"), type='html')
print(xtable(coxph.table.hand.Raptor.female, digits=c(0,3,3,3,10),caption = "Gene Level Cox Proportional Hazard Tests for Females with Hand-Gal4 Drivers and Raptor Knockdown", label = "tab:coxph.table.hand.raptor.female"), type='html')
```

```{r survival-hand-tsc1,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Survival of Tsc1 shRNA Flies with Hand-GAL4 Driver', gene),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```

```{r survival-hand-tsc1-gender,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(1,2))
    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='male',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Males',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='female',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Females',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100,
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```

```{r survival-hand-raptor,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Raptor'&data$Genotype!='Tm3/Tm6B',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Survival of Raptor shRNA Flies with Hand-GAL4 Driver', gene),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```


```{r survival-hand-raptor-gender,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(1,2))
    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Raptor'&data$Genotype!='Tm3/Tm6B'&data$Gender=='male',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Males',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Raptor'&data$Genotype!='Tm3/Tm6B'&data$Gender=='female',])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = 'Females',
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
```


## Tsc1 Knockdown with Hand-Gal4

We performed a variety of survival tests for the was a Hand-Gal4 driven *Tsc1* knockdowns (see Tables \ref{tab:coxph-summary-hand} and \ref{tab:coxph-summary-hand-gender}).  These tests removed the Tm3/Tm6B flies, which in all cases died prematurely.  The logrank test was highly significant (p=`r summary.coxph.hand.gene['Tsc',]$logtest.p`) for the combined comparasons and both males (p=`r summary.coxph.hand.gene.gender['Tsc1 male','logtest.p']`) and females (p=`r summary.coxph.hand.gene.gender['Tsc1 female','logtest.p']`).

For post-hoc testing, we performed cox proportional hazard tests, shown in Tables \ref{tab:coxph.table.hand.tsc1}, \ref{tab:coxph.table.hand.tsc1.male} and \ref{tab:coxph.table.hand.tsc1.female}.  All comparasons were highly significant all less than `r max(rbind(coxph.table.hand.Tsc1.male,coxph.table.hand.Tsc1.female)$p)`.  The instantaneous hazard ratios ranged from `r min(rbind(coxph.table.hand.Tsc1.male,coxph.table.hand.Tsc1.female)$Hazard.Ratio)` to `r max(rbind(coxph.table.hand.Tsc1.male,coxph.table.hand.Tsc1.female)$Hazard.Ratio)`, in terms of that much less likely to die than the knockdown flies.  These results are presented graphically in Figures \ref{fig:survival-hand-tsc1} and \ref{fig:survival-hand-tsc1-gender}.


## Raptor Knockdown with Hand-Gal4

We performed further survival tests for the was a Hand-Gal4 driven \textit{Raptor} knockdowns (see Tables \ref{tab:coxph-summary-hand} and \ref{tab:coxph-summary-hand-gender}).  These tests removed the Tm3/Tm6B flies, which in all cases died prematurely.  The logrank test was highly significant (p=`r summary.coxph.hand.gene['Raptor',]$logtest.p`) for the combined comparasons and both males (p=`r summary.coxph.hand.gene.gender['Raptor male','logtest.p']`) and females (p=`r summary.coxph.hand.gene.gender['Raptor female','logtest.p']`).

For post-hoc testing, we performed cox proportional hazard tests, shown in Tables \ref{tab:coxph.table.hand.raptor}, \ref{tab:coxph.table.hand.raptor.male} and \ref{tab:coxph.table.hand.raptor.female}.  All comparasons were highly significant all less than `r max(rbind(coxph.table.hand.Raptor.male,coxph.table.hand.Raptor.female)$p)`.  The instantaneous hazard ratios ranged from `r min(rbind(coxph.table.hand.Raptor.male,coxph.table.hand.Raptor.female)$Hazard.Ratio)` to `r max(rbind(coxph.table.hand.Raptor.male,coxph.table.hand.Raptor.female)$Hazard.Ratio)`, in terms of that much less likely to die than the knockdown flies.  These results are presented graphically in Figures \ref{fig:survival-hand-raptor} and \ref{fig:survival-hand-raptor-gender}.


### Strain Level Analysis

```{r survival-24b-tsc-gender-strain,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(3,2))
for (uas in mapping_data[mapping_data$Gene=='Tsc1','UAS']){
    data.used <- droplevels(data[data$Driver=='24B-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='male'&data$UAS==uas,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Males-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         las=1,
         yscale=100, 
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='24B-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='female'&data$UAS==uas,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Females-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
}
```

### Strain Level Graphs for C179-Gal4 Driven Knockdowns

```{r survival-c179-raptor-gender-strain,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(3,2))
for (uas in mapping_data[mapping_data$Gene=='Raptor','UAS']){
    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%c('Control','Raptor')&data$Genotype!='Tm3/Tm6B'&data$Gender=='male'&data$UAS%in%c('36304',uas),])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Males-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         las=1,
         yscale=100, 
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%c('Control','Raptor')&data$Genotype!='Tm3/Tm6B'&data$Gender=='female'&data$UAS%in%c('36304',uas),])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Females-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
}
```



```{r survival-c179-raptor-gender-strain-adult,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(3,2))
for (uas in mapping_data[mapping_data$Gene=='Raptor','UAS']){
    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%c('Control','Raptor')&data$Genotype!='Tm3/Tm6B'&data$Gender=='male'&data$UAS%in%c('36304',uas)&data$Age>40,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Males-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         las=1,
         yscale=100, 
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='C179-Gal4'&data$Gene%in%c('Control','Raptor')&data$Genotype!='Tm3/Tm6B'&data$Gender=='female'&data$UAS%in%c('36304',uas)&data$Age>40,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Females-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
}
```


```{r survival-hand-raptor-gender-strain,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(3,2))
for (uas in mapping_data[mapping_data$Gene=='Raptor','UAS']){
    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Raptor'&data$Genotype!='Tm3/Tm6B'&data$Gender=='male'&data$UAS==uas,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Males-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         las=1,
         yscale=100, 
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Raptor'&data$Genotype!='Tm3/Tm6B'&data$Gender=='female'&data$UAS==uas,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Females-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
}
```


```{r survival-hand-tsc1-gender-strain,fig=TRUE,echo=FALSE, dev=c('pdf','png')}
par(mfrow=c(3,2))
for (uas in mapping_data[mapping_data$Gene=='Tsc1','UAS']){
    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='male'&data$UAS==uas,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Males-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         las=1,
         yscale=100, 
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")

    data.used <- droplevels(data[data$Driver=='Hand-Gal4'&data$Gene=='Tsc1'&data$Genotype!='Tm3/Tm6B'&data$Gender=='female'&data$UAS==uas,])
    survobj <- with(data.used, Surv(Age, Accidental==FALSE))
    survfit <- survfit(survobj~Genotype, data=data.used)
    plot(survfit, main = sprintf('Females-%s',uas),
         xlab= 'Days',
         ylab= 'Percent Survival',
         yscale=100, 
         las=1,
         lty=c(1,2,2),
         col= genotype.colors)
    legend("bottomleft", levels(data.used$Genotype), col=genotype.colors, lty=c(1,2,2), bty="n")
}
```



## Session Information
```{r sessionInfo, echo=F}
sessionInfo()
```