{
    "contents" : "\\documentclass{article}\n\n\\usepackage{fullpage}\n\\usepackage[colorlinks=true]{hyperref}\n\\usepackage[tableposition=top]{caption}\n\\usepackage[utf8]{inputenc}\n\n\\begin{document}\n\\SweaveOpts{concordance=FALSE}\n\n\\title{Analysis of Births Ratios from Muscle Srebp1/Atg Flies}\n\\author{Isabelle Hatfield and Dave Bridges}\n\\date{\\today}\n\\maketitle\n\n\n\\section*{Experimental Design}\n\n<<data-input, echo=FALSE>>=\nspreadsheet_location <- 'https://docs.google.com/spreadsheet/pub?key=0Am2qM2oZ12_jdHhNTjNuc25zdDJKZzR3MzVuUUU4dEE&single=true&gid=0&output=csv' \nmapping.data <- read.csv('../Data/gene_mapping.csv')\n\ndata_file_name <- '../Data/effector_birth_worksheet.csv'\ndownload.file(spreadsheet_location, data_file_name, method=\"curl\")\n\ndata <- read.csv(data_file_name)\ndata$Total <- rowSums(data[,10:11])\nall.flies <- colSums(data[,10:11])\nrequire(plyr, quietly=T)\ndata$Cross <- as.factor(paste(data$Male, data$Female, sep=\" x \"))\ndata$Driver <- as.factor(sapply(strsplit(as.character(data$Female), \"/\"),\"[\", 1))\nuas.order <- c('25975','34073','27551','28989','34340','27554','34900') \n\ndata$UAS <- sapply(strsplit(as.character(data$Male), \"/\"),\"[\", 1)\n#merged with gene mapping file\ndata <- merge(mapping.data, data, by=\"UAS\")\ndata$UAS <- factor(data$UAS, levels=uas.order)\n@\n\nThese data are stored in \\verb+\\Sexpr{getwd()}+.  This script was most recently run on \\Sexpr{date()}\n\n\\section*{Strain Summaries}\n\n<<data-analysis, echo=FALSE>>=\ngene.summarised.data <- ddply(data, .(Driver,Gene), summarise, \n      KD = sum(WT, na.rm=T),\n      Control = sum(Ser.Sb, na.rm=T),\n      Total = as.integer(sum(Total)))\n\ngene.summarised.data$pval <-rep(NA, dim(gene.summarised.data)[1])\nfor (n in seq(1,dim(gene.summarised.data)[1])) {   \n  values <- gene.summarised.data[n,3:4]\n  test <- chisq.test(values, p=rep(1,2), rescale.p=T)\n  gene.summarised.data[n,]$pval <- test$p.value  \n}\ngene.summarised.data$padj <- p.adjust(gene.summarised.data$pval, method=\"BH\")\n\ndriver.summarised.data <- ddply(data, .(Driver,UAS), summarise, \n      KD = sum(WT, na.rm=T),\n      Control = sum(Ser.Sb, na.rm=T),\n      Total = as.integer(sum(Total)))\n\ndriver.summarised.data$pval <-rep(NA, dim(driver.summarised.data)[1])\nfor (n in seq(1,dim(driver.summarised.data)[1])) {   \n  values <- driver.summarised.data[n,3:4]\n  test <- chisq.test(values, p=c(1,1), rescale.p=T)\n  driver.summarised.data[n,]$pval <- test$p.value  \n}\ndriver.summarised.data$padj <- p.adjust(driver.summarised.data$pval, method=\"BH\")\n\nsummarised.data <- ddply(data, ~Cross, summarise, \n      KD = sum(WT, na.rm=T),\n      Control = sum(Ser.Sb, na.rm=T),\n      Total = as.integer(sum(Total)))\nall.progeny <-rep(NA, length(levels(data$Cross)))\nnames(all.progeny) <- levels(data$Cross)\nfor (n in seq(1,length(levels(data$Cross)))){\n  values <- summarised.data[n,2:3]\n  test <- chisq.test(values, p=rep(1,2), rescale.p=T)\n  all.progeny[levels(data$Cross)[n]] <- test$p.value  \n}\nall.progeny.padj <- cbind(pval=all.progeny, padj=p.adjust(all.progeny, method=\"BH\"))\n\nsummarised.data$pval <-rep(NA, dim(summarised.data)[1])\nfor (n in seq(1,length(levels(summarised.data$Cross)))) {\n  values <- summarised.data[n,2:3]\n  test <- chisq.test(values, p=rep(1,2), rescale.p=T)\n  summarised.data[n,]$pval <- test$p.value  \n}\nsummarised.data$padj <- p.adjust(summarised.data$pval, method=\"BH\")\n\nsummarised.data.gendered <- ddply(data, .(UAS, Driver,Gender), summarise, \n      KD = sum(WT, na.rm=T),\n      Control = sum(Ser.Sb, na.rm=T),\n      Total = as.integer(sum(Total)))\n\nsummarised.data.gendered$pval <-rep(NA, dim(summarised.data.gendered)[1])\nfor (n in seq(1,dim(summarised.data.gendered)[1])) {   \n  values <- summarised.data.gendered[n,4:5]\n  test <- chisq.test(values, p=rep(1,2), rescale.p=T)\n  summarised.data.gendered[n,]$pval <- test$p.value  \n}\nsummarised.data.gendered$padj <- p.adjust(summarised.data.gendered$pval, method=\"BH\")\n@\n\nSo far this analysis includes \\textbf{\\Sexpr{sum(all.flies)}} flies from \\Sexpr{length(levels(data$Cross))} crosses.  Statistics are based on a Chi Squared Test, and are  adjusted for multiple observation by the method of Benjamini and Hochberg.  Counts and p-values are shown in Table \\ref{tab:gene_summarised_data}, \\ref{tab:driver_summarised_data} and Figure \\ref{fig:barplots} for all drivers, Table \\ref{tab:summarised_data} for all crosses and Table \\ref{tab:gendered_data} with gendered crossed data.  Summarized per cross the data are below\n\n\n<<label=data-tables,echo=FALSE,results=tex>>=\nrequire(xtable)\nprint(xtable(gene.summarised.data, caption=\"Gene Level Summarised Data\", label=\"tab:gene_summarised_data\", digits = c(rep(0,6),5,5)), include.rownames=F)\nprint(xtable(driver.summarised.data[order(driver.summarised.data$Driver,driver.summarised.data$UAS),], caption=\"Driver Level Summarised Data\", label=\"tab:driver_summarised_data\", digits = c(rep(0,6),5,5)), include.rownames=F)\nprint(xtable(summarised.data[order(summarised.data$Cross),], caption=\"Cross Level Summarised Data\", label=\"tab:summarised_data\", digits = c(rep(0,5),5,5)), include.rownames=F)\nprint(xtable(summarised.data.gendered[order(summarised.data.gendered$Driver, summarised.data.gendered$UAS),], caption=\"Gendered and Cross Level Summarised Data\", label=\"tab:gendered_data\", digits = c(rep(0,7),5,5)), include.rownames=F)\n@\n\n\n<<label=24b-figure,include=FALSE, echo=FALSE>>=\ndriver.summarised.data$Total.No.WT <- rowSums(driver.summarised.data[,c('KD','Control') ])\ndriver.summarised.data$KD.prop <- driver.summarised.data$KD/driver.summarised.data$Total.No.WT\ndriver.summarised.data$Control.prop <- driver.summarised.data$Control/driver.summarised.data$Total.No.WT\n\n#calculated standard errors\ndriver.summarised.data$KD.err <- with(driver.summarised.data, sqrt((KD.prop*(1-KD.prop)/Total.No.WT)))\ndriver.summarised.data$Control.err <- with(driver.summarised.data, sqrt((Control.prop*(1-Control.prop)/Total.No.WT)))\n\n\n\nrequire(RColorBrewer, quietly=T)\nplot <- barplot(t(as.matrix(driver.summarised.data[driver.summarised.data$Driver==\"24B-Gal4\",c('KD.prop','Control.prop')])),\n        names.arg=driver.summarised.data[driver.summarised.data$Driver==\"24B-Gal4\",]$UAS,\n        beside=T,\n        ylab=\"Proportion of Eclosed Flies\",\n        ylim=c(0,1),\n        main=\"24B-Gal4 Driver\")\nabline(a=1/2,b=0, lty=2)\nlegend(\"topleft\", c(\"shRNA/GAL4\",\"GAL4/+ or shRNA/+\"), bty=\"n\", fill=grey.colors(2))\n\nsuperpose.eb <- \n function (x, y, ebl, ebu = ebl, length = 0.08, ...) \n arrows(x, y + ebu, x, y - ebl, angle = 90, code = 3, \n length = length, ...)\n\nsuperpose.eb(plot, \n             t(as.matrix(driver.summarised.data[driver.summarised.data$Driver==\"24B-Gal4\",c('KD.prop','Control.prop')])),\n             t(as.matrix(driver.summarised.data[driver.summarised.data$Driver==\"24B-Gal4\",c('KD.err','Control.err')])))\n@\n\n\\begin{figure}\n\\begin{center}\n<<label=24b-figures,fig=TRUE,echo=FALSE>>=\n<<24b-figure>>\n@\n\\end{center}\n\\caption{Barplot of Relative Phosphorylation}\n\\label{fig:barplots}\n\\end{figure}\n\n     \n<<bibliography, include=F, echo=F>>=\nrequire(bibtex)\nwrite.bib(c(names(sessionInfo()$otherPkgs),'base','stats','utils'), file='birth-references.bib')\n@\n\nThe key packages used in this analysis were R \\cite{base} and plyr \\cite{plyr}\n\n\\bibliography{birth-references}\n\\bibliographystyle{unsrt}\n\n\\section*{Session Information}\n<<sessionInfo, results=tex, echo=F>>=\ntoLatex(sessionInfo())\n@\n\n\\end{document}",
    "created" : 1393254833657.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "337956492",
    "id" : "BBA176B2",
    "lastKnownWriteTime" : 1393254844,
    "path" : "/Volumes/bridges_lab/Hatfield/Drosophila/Births/effectors-birth-ratio-analysis.Rnw",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "sweave"
}